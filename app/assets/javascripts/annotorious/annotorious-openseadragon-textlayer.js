(function(N,H){typeof exports=="object"&&typeof module<"u"?H(exports):typeof define=="function"&&define.amd?define(["exports"],H):(N=typeof globalThis<"u"?globalThis:N||self,H(N.OSDTextLayer={}))})(this,function(N){"use strict";var Ao=Object.defineProperty;var Io=(N,H,Y)=>H in N?Ao(N,H,{enumerable:!0,configurable:!0,writable:!0,value:Y}):N[H]=Y;var he=(N,H,Y)=>(Io(N,typeof H!="symbol"?H+"":H,Y),Y);const H=t=>{var e;return(e=t.bodies.find(n=>n.purpose==="transcribing"))==null?void 0:e.value};let Y;const Ze=new Uint8Array(16);function Je(){if(!Y&&(Y=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Y))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Y(Ze)}const A=[];for(let t=0;t<256;++t)A.push((t+256).toString(16).slice(1));function tn(t,e=0){return A[t[e+0]]+A[t[e+1]]+A[t[e+2]]+A[t[e+3]]+"-"+A[t[e+4]]+A[t[e+5]]+"-"+A[t[e+6]]+A[t[e+7]]+"-"+A[t[e+8]]+A[t[e+9]]+"-"+A[t[e+10]]+A[t[e+11]]+A[t[e+12]]+A[t[e+13]]+A[t[e+14]]+A[t[e+15]]}const en=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ge={randomUUID:en};function nn(t,e,n){if(ge.randomUUID&&!e&&!t)return ge.randomUUID();t=t||{};const o=t.random||(t.rng||Je)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,e){n=n||0;for(let r=0;r<16;++r)e[n+r]=o[r];return e}return tn(o)}const on="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(on);var st=(t=>(t.ELLIPSE="ELLIPSE",t.POLYGON="POLYGON",t.RECTANGLE="RECTANGLE",t))(st||{});const Kt=(t,e)=>e,rn={area:t=>Math.PI*t.geometry.rx*t.geometry.ry,intersects:(t,e,n)=>{const{cx:o,cy:r,rx:s,ry:i}=t.geometry,c=0,a=Math.cos(c),l=Math.sin(c),p=e-o,f=n-r,d=a*p+l*f,g=l*p-a*f;return d*d/(s*s)+g*g/(i*i)<=1}};Kt(st.ELLIPSE,rn);const sn={area:t=>{const{points:e}=t.geometry;let n=0,o=e.length-1;for(let r=0;r<e.length;r++)n+=(e[o][0]+e[r][0])*(e[o][1]-e[r][1]),o=r;return Math.abs(.5*n)},intersects:(t,e,n)=>{const{points:o}=t.geometry;let r=!1;for(let s=0,i=o.length-1;s<o.length;i=s++){const c=o[s][0],a=o[s][1],l=o[i][0],p=o[i][1];a>n!=p>n&&e<(l-c)*(n-a)/(p-a)+c&&(r=!r)}return r}};Kt(st.POLYGON,sn);const an={area:t=>t.geometry.w*t.geometry.h,intersects:(t,e,n)=>e>=t.geometry.x&&e<=t.geometry.x+t.geometry.w&&n>=t.geometry.y&&n<=t.geometry.y+t.geometry.h};Kt(st.RECTANGLE,an);const cn=[];for(let t=0;t<256;++t)cn.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const ln=[];for(let t=0;t<256;++t)ln.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),((t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),""))(),st.RECTANGLE,st.POLYGON,navigator.userAgent.indexOf("Mac OS X");const fn=t=>{const e=[];let n=0;const o=t.querySelectorAll("String");for(const r of o){const s=r.getAttribute("ID")||nn(),i=r.getAttribute("CONTENT"),c=parseFloat(r.getAttribute("HPOS")),a=parseFloat(r.getAttribute("VPOS")),l=parseFloat(r.getAttribute("WIDTH")),p=parseFloat(r.getAttribute("HEIGHT")),f=c+l,d=a+p;n+=p,e.push({id:s,bodies:[{id:s,annotation:s,purpose:"transcribing",value:i}],target:{annotation:s,selector:{type:st.RECTANGLE,geometry:{bounds:{minX:c,minY:a,maxX:f,maxY:d},x:c,y:a,w:l,h:p}}}})}return{annotations:e,averageHeight:n/o.length}},un=t=>{const e=[];let n=0;const o=new DOMParser().parseFromString(t,"application/xml"),r=o.querySelector("Page"),s=o.querySelectorAll("TextLine");for(const p of s){const{annotations:f,averageHeight:d}=fn(p);n+=d,e.push(...f)}const i=r.getAttribute("ID"),c=parseFloat(r.getAttribute("HEIGHT")),a=parseFloat(r.getAttribute("WIDTH")),l=n/s.length;return{annotations:e,metadata:{id:i,height:c,width:a,averageLineHeight:l}}};function q(){}function me(t){return t()}function ye(){return Object.create(null)}function $t(t){t.forEach(me)}function _e(t){return typeof t=="function"}function It(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function dn(t){return Object.keys(t).length===0}function K(t,e){t.appendChild(e)}function F(t,e,n){t.insertBefore(e,n||null)}function U(t){t.parentNode&&t.parentNode.removeChild(t)}function Qt(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function at(t){return document.createElement(t)}function ct(t){return document.createTextNode(t)}function lt(){return ct("")}function X(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function pn(t){return Array.from(t.childNodes)}function Zt(t,e){e=""+e,t.data!==e&&(t.data=e)}function R(t,e,n){t.classList.toggle(e,!!n)}let xt;function Et(t){xt=t}function hn(){if(!xt)throw new Error("Function called outside component initialization");return xt}function gn(t){hn().$$.on_mount.push(t)}const pt=[],Mt=[];let ht=[];const be=[],mn=Promise.resolve();let Jt=!1;function yn(){Jt||(Jt=!0,mn.then(we))}function te(t){ht.push(t)}const ee=new Set;let gt=0;function we(){if(gt!==0)return;const t=xt;do{try{for(;gt<pt.length;){const e=pt[gt];gt++,Et(e),_n(e.$$)}}catch(e){throw pt.length=0,gt=0,e}for(Et(null),pt.length=0,gt=0;Mt.length;)Mt.pop()();for(let e=0;e<ht.length;e+=1){const n=ht[e];ee.has(n)||(ee.add(n),n())}ht.length=0}while(pt.length);for(;be.length;)be.pop()();Jt=!1,ee.clear(),Et(t)}function _n(t){if(t.fragment!==null){t.update(),$t(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(te)}}function bn(t){const e=[],n=[];ht.forEach(o=>t.indexOf(o)===-1?e.push(o):n.push(o)),n.forEach(o=>o()),ht=e}const kt=new Set;let ft;function St(){ft={r:0,c:[],p:ft}}function Tt(){ft.r||$t(ft.c),ft=ft.p}function P(t,e){t&&t.i&&(kt.delete(t),t.i(e))}function v(t,e,n,o){if(t&&t.o){if(kt.has(t))return;kt.add(t),ft.c.push(()=>{kt.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}else o&&o()}function mt(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function ne(t){t&&t.c()}function Nt(t,e,n){const{fragment:o,after_update:r}=t.$$;o&&o.m(e,n),te(()=>{const s=t.$$.on_mount.map(me).filter(_e);t.$$.on_destroy?t.$$.on_destroy.push(...s):$t(s),t.$$.on_mount=[]}),r.forEach(te)}function Ht(t,e){const n=t.$$;n.fragment!==null&&(bn(n.after_update),$t(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function wn(t,e){t.$$.dirty[0]===-1&&(pt.push(t),yn(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function vt(t,e,n,o,r,s,i=null,c=[-1]){const a=xt;Et(t);const l=t.$$={fragment:null,ctx:[],props:s,update:q,not_equal:r,bound:ye(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:ye(),dirty:c,skip_bound:!1,root:e.target||a.$$.root};i&&i(l.root);let p=!1;if(l.ctx=n?n(t,e.props||{},(f,d,...g)=>{const y=g.length?g[0]:d;return l.ctx&&r(l.ctx[f],l.ctx[f]=y)&&(!l.skip_bound&&l.bound[f]&&l.bound[f](y),p&&wn(t,f)),d}):[],l.update(),p=!0,$t(l.before_update),l.fragment=o?o(l.ctx):!1,e.target){if(e.hydrate){const f=pn(e.target);l.fragment&&l.fragment.l(f),f.forEach(U)}else l.fragment&&l.fragment.c();e.intro&&P(t.$$.fragment),Nt(t,e.target,e.anchor),we()}Et(a)}class zt{constructor(){he(this,"$$");he(this,"$$set")}$destroy(){Ht(this,1),this.$destroy=q}$on(e,n){if(!_e(n))return q;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const r=o.indexOf(n);r!==-1&&o.splice(r,1)}}$set(e){this.$$set&&!dn(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const $n="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add($n);function $e(t){let e,n,o,r,s;return{c(){e=at("div"),n=at("span"),o=ct(t[3]),r=ct(" "),X(e,"class","annotation"),X(e,"style",s=`left:${t[7]}px; top:${t[6]}px; width: ${t[2]}px; height: ${t[1]}px; transform: scale(${t[5]}, ${t[4]})`)},m(i,c){F(i,e,c),K(e,n),K(n,o),t[11](n),K(e,r)},p(i,c){c&8&&Zt(o,i[3]),c&246&&s!==(s=`left:${i[7]}px; top:${i[6]}px; width: ${i[2]}px; height: ${i[1]}px; transform: scale(${i[5]}, ${i[4]})`)&&X(e,"style",s)},d(i){i&&U(e),t[11](null)}}}function xn(t){let e,n=t[3]&&$e(t);return{c(){n&&n.c(),e=lt()},m(o,r){n&&n.m(o,r),F(o,e,r)},p(o,[r]){o[3]?n?n.p(o,r):(n=$e(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:q,o:q,d(o){o&&U(e),n&&n.d(o)}}}function En(t,e,n){let o,r,s,i,c,a,l,p,f,{annotation:d}=e,{opts:g}=e;function y(h){Mt[h?"unshift":"push"](()=>{f=h,n(0,f)})}return t.$$set=h=>{"annotation"in h&&n(8,d=h.annotation),"opts"in h&&n(9,g=h.opts)},t.$$.update=()=>{t.$$.dirty&256&&n(10,o=d.target.selector.geometry.bounds),t.$$.dirty&1024&&n(7,r=o.minX),t.$$.dirty&1024&&n(6,s=o.minY),t.$$.dirty&1024&&n(2,i=o.maxX-o.minX),t.$$.dirty&1024&&n(1,c=o.maxY-o.minY),t.$$.dirty&5&&n(5,a=f?i/f.offsetWidth:1),t.$$.dirty&3&&n(4,l=f?c/f.offsetHeight:1),t.$$.dirty&768&&n(3,p=g.label(d))},[f,c,i,p,l,a,s,r,d,g,o,y]}class Sn extends zt{constructor(e){super(),vt(this,e,En,xn,It,{annotation:8,opts:9})}}function xe(t){let e,n,o,r,s;return{c(){e=at("div"),n=at("span"),o=ct(t[1]),r=ct(" "),X(e,"class","annotation"),X(e,"style",s=t[3](t[2]))},m(i,c){F(i,e,c),K(e,n),K(n,o),t[6](n),K(e,r)},p(i,c){c&2&&Zt(o,i[1]),c&4&&s!==(s=i[3](i[2]))&&X(e,"style",s)},d(i){i&&U(e),t[6](null)}}}function Tn(t){let e,n=t[1]&&xe(t);return{c(){n&&n.c(),e=lt()},m(o,r){n&&n.m(o,r),F(o,e,r)},p(o,[r]){o[1]?n?n.p(o,r):(n=xe(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:q,o:q,d(o){o&&U(e),n&&n.d(o)}}}function Ln(t,e,n){let o,r,s,i,{annotation:c}=e,{opts:a}=e;const l=f=>{const d=a.offsetX||0,g=a.offsetY||0;if(a.position==="center"){const y=o.maxX-o.minX,h=o.minX+y/2-f[0]/2,m=o.maxY-o.minY,b=o.minY+m/2-f[1]/2;return`left:${h+d}px; top:${b+g}px;`}else return a.position==="topleft"?`left:${o.minX+d}px; top:${o.minY+g}px;`:`left:${o.minX+d}px; top:${o.maxY+g}px;`};function p(f){Mt[f?"unshift":"push"](()=>{i=f,n(0,i)})}return t.$$set=f=>{"annotation"in f&&n(4,c=f.annotation),"opts"in f&&n(5,a=f.opts)},t.$$.update=()=>{t.$$.dirty&16&&(o=c.target.selector.geometry.bounds),t.$$.dirty&1&&n(2,r=i?[i.offsetWidth,i.offsetHeight]:[0,0]),t.$$.dirty&48&&n(1,s=a.label(c))},[i,s,r,l,c,a,p]}class On extends zt{constructor(e){super(),vt(this,e,Ln,Tn,It,{annotation:4,opts:5})}}function Ee(t){let e,n,o,r,s;return{c(){e=at("div"),n=at("span"),o=ct(t[1]),r=ct(" "),X(e,"class","annotation"),X(e,"style",s=t[4](t[3],t[2],t[0]))},m(i,c){F(i,e,c),K(e,n),K(n,o),K(e,r)},p(i,c){c&2&&Zt(o,i[1]),c&13&&s!==(s=i[4](i[3],i[2],i[0]))&&X(e,"style",s)},d(i){i&&U(e)}}}function Pn(t){let e,n=t[1]&&Ee(t);return{c(){n&&n.c(),e=lt()},m(o,r){n&&n.m(o,r),F(o,e,r)},p(o,[r]){o[1]?n?n.p(o,r):(n=Ee(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:q,o:q,d(o){o&&U(e),n&&n.d(o)}}}function An(t,e,n){let o,r,s,i,{annotation:c}=e,{opts:a}=e,{scale:l}=e,{imageSize:p}=e;const f=(d,g,y)=>{const h=(a.offsetX||0)/y,m=(a.offsetY||0)/y;if(a.position==="topleft"){const b=p[1]-g;return`left:${d+h}px; bottom:${b}px; transform: scale(${1/y})`}else return`left:${d+h}px; top:${g+m}px; transform: scale(${1/y})`};return t.$$set=d=>{"annotation"in d&&n(5,c=d.annotation),"opts"in d&&n(6,a=d.opts),"scale"in d&&n(0,l=d.scale),"imageSize"in d&&n(7,p=d.imageSize)},t.$$.update=()=>{t.$$.dirty&32&&n(8,o=c.target.selector.geometry.bounds),t.$$.dirty&256&&n(3,r=o.minX),t.$$.dirty&320&&n(2,s=a.position==="topleft"?o.minY:o.maxY),t.$$.dirty&96&&n(1,i=a.label(c))},[l,i,s,r,f,c,a,p,o]}class In extends zt{constructor(e){super(),vt(this,e,An,Pn,It,{annotation:5,opts:6,scale:0,imageSize:7})}}var Mn=Object.defineProperty,kn=(t,e,n)=>e in t?Mn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Se=(t,e,n)=>(kn(t,typeof e!="symbol"?e+"":e,n),n);function Lt(){}function oe(t,e){for(const n in e)t[n]=e[n];return t}function Te(t){return t()}function Le(){return Object.create(null)}function Q(t){t.forEach(Te)}function M(t){return typeof t=="function"}function Gt(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Nn(t){return Object.keys(t).length===0}function Hn(t,e,n,o){if(t){const r=Oe(t,e,n,o);return t[0](r)}}function Oe(t,e,n,o){return t[1]&&o?oe(n.ctx.slice(),t[1](o(e))):n.ctx}function vn(t,e,n,o){if(t[2]&&o){const r=t[2](o(n));if(e.dirty===void 0)return r;if(typeof r=="object"){const s=[],i=Math.max(e.dirty.length,r.length);for(let c=0;c<i;c+=1)s[c]=e.dirty[c]|r[c];return s}return e.dirty|r}return e.dirty}function zn(t,e,n,o,r,s){if(r){const i=Oe(e,n,o,s);t.p(i,r)}}function Gn(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let o=0;o<n;o++)e[o]=-1;return e}return-1}function Pe(t){const e={};for(const n in t)n[0]!=="$"&&(e[n]=t[n]);return e}function Ut(t){return t??""}function Ae(t,e){t.appendChild(e)}function T(t,e,n){t.insertBefore(e,n||null)}function S(t){t.parentNode&&t.parentNode.removeChild(t)}function Un(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function z(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Ie(t){return document.createTextNode(t)}function B(){return Ie(" ")}function Me(){return Ie("")}function I(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function u(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Xn(t){return Array.from(t.childNodes)}function ke(t,e,n){t.classList.toggle(e,!!n)}function Rn(t,e,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:o})}let Ot;function Pt(t){Ot=t}function Dn(){if(!Ot)throw new Error("Function called outside component initialization");return Ot}function Cn(){const t=Dn();return(e,n,{cancelable:o=!1}={})=>{const r=t.$$.callbacks[e];if(r){const s=Rn(e,n,{cancelable:o});return r.slice().forEach(i=>{i.call(t,s)}),!s.defaultPrevented}return!0}}function Z(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(o=>o.call(this,e))}const yt=[],Ne=[];let _t=[];const He=[],Fn=Promise.resolve();let re=!1;function Bn(){re||(re=!0,Fn.then(ve))}function ie(t){_t.push(t)}const se=new Set;let bt=0;function ve(){if(bt!==0)return;const t=Ot;do{try{for(;bt<yt.length;){const e=yt[bt];bt++,Pt(e),jn(e.$$)}}catch(e){throw yt.length=0,bt=0,e}for(Pt(null),yt.length=0,bt=0;Ne.length;)Ne.pop()();for(let e=0;e<_t.length;e+=1){const n=_t[e];se.has(n)||(se.add(n),n())}_t.length=0}while(yt.length);for(;He.length;)He.pop()();re=!1,se.clear(),Pt(t)}function jn(t){if(t.fragment!==null){t.update(),Q(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ie)}}function Yn(t){const e=[],n=[];_t.forEach(o=>t.indexOf(o)===-1?e.push(o):n.push(o)),n.forEach(o=>o()),_t=e}const Xt=new Set;let ut;function Vn(){ut={r:0,c:[],p:ut}}function Wn(){ut.r||Q(ut.c),ut=ut.p}function D(t,e){t&&t.i&&(Xt.delete(t),t.i(e))}function V(t,e,n,o){if(t&&t.o){if(Xt.has(t))return;Xt.add(t),ut.c.push(()=>{Xt.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}else o&&o()}function ze(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function dt(t){t&&t.c()}function tt(t,e,n){const{fragment:o,after_update:r}=t.$$;o&&o.m(e,n),ie(()=>{const s=t.$$.on_mount.map(Te).filter(M);t.$$.on_destroy?t.$$.on_destroy.push(...s):Q(s),t.$$.on_mount=[]}),r.forEach(ie)}function et(t,e){const n=t.$$;n.fragment!==null&&(Yn(n.after_update),Q(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function qn(t,e){t.$$.dirty[0]===-1&&(yt.push(t),Bn(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Rt(t,e,n,o,r,s,i=null,c=[-1]){const a=Ot;Pt(t);const l=t.$$={fragment:null,ctx:[],props:s,update:Lt,not_equal:r,bound:Le(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:Le(),dirty:c,skip_bound:!1,root:e.target||a.$$.root};i&&i(l.root);let p=!1;if(l.ctx=n?n(t,e.props||{},(f,d,...g)=>{const y=g.length?g[0]:d;return l.ctx&&r(l.ctx[f],l.ctx[f]=y)&&(!l.skip_bound&&l.bound[f]&&l.bound[f](y),p&&qn(t,f)),d}):[],l.update(),p=!0,Q(l.before_update),l.fragment=o?o(l.ctx):!1,e.target){if(e.hydrate){const f=Xn(e.target);l.fragment&&l.fragment.l(f),f.forEach(S)}else l.fragment&&l.fragment.c();e.intro&&D(t.$$.fragment),tt(t,e.target,e.anchor),ve()}Pt(a)}class Dt{constructor(){Se(this,"$$"),Se(this,"$$set")}$destroy(){et(this,1),this.$destroy=Lt}$on(e,n){if(!M(n))return Lt;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const r=o.indexOf(n);r!==-1&&o.splice(r,1)}}$set(e){this.$$set&&!Nn(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Kn="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Kn);var W=(t=>(t.ELLIPSE="ELLIPSE",t.POLYGON="POLYGON",t.RECTANGLE="RECTANGLE",t))(W||{});const ae=(t,e)=>e,Qn=t=>{let e=1/0,n=1/0,o=-1/0,r=-1/0;return t.forEach(([s,i])=>{e=Math.min(e,s),n=Math.min(n,i),o=Math.max(o,s),r=Math.max(r,i)}),{minX:e,minY:n,maxX:o,maxY:r}},Zn={area:t=>Math.PI*t.geometry.rx*t.geometry.ry,intersects:(t,e,n)=>{const{cx:o,cy:r,rx:s,ry:i}=t.geometry,c=0,a=Math.cos(c),l=Math.sin(c),p=e-o,f=n-r,d=a*p+l*f,g=l*p-a*f;return d*d/(s*s)+g*g/(i*i)<=1}};ae(W.ELLIPSE,Zn);const Jn={area:t=>{const{points:e}=t.geometry;let n=0,o=e.length-1;for(let r=0;r<e.length;r++)n+=(e[o][0]+e[r][0])*(e[o][1]-e[r][1]),o=r;return Math.abs(.5*n)},intersects:(t,e,n)=>{const{points:o}=t.geometry;let r=!1;for(let s=0,i=o.length-1;s<o.length;i=s++){const c=o[s][0],a=o[s][1],l=o[i][0],p=o[i][1];a>n!=p>n&&e<(l-c)*(n-a)/(p-a)+c&&(r=!r)}return r}};ae(W.POLYGON,Jn);const to={area:t=>t.geometry.w*t.geometry.h,intersects:(t,e,n)=>e>=t.geometry.x&&e<=t.geometry.x+t.geometry.w&&n>=t.geometry.y&&n<=t.geometry.y+t.geometry.h};ae(W.RECTANGLE,to);const eo=[];for(let t=0;t<256;++t)eo.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const no=[];for(let t=0;t<256;++t)no.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),((t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),""))();function Ge(t,e,n){const o=t.slice();return o[10]=e[n],o[12]=n,o}function Ue(t){let e,n;return e=new At({props:{x:t[10][0],y:t[10][1],scale:t[3]}}),e.$on("pointerdown",function(){M(t[9](`HANDLE-${t[12]}`))&&t[9](`HANDLE-${t[12]}`).apply(this,arguments)}),{c(){dt(e.$$.fragment)},m(o,r){tt(e,o,r),n=!0},p(o,r){t=o;const s={};r&16&&(s.x=t[10][0]),r&16&&(s.y=t[10][1]),r&8&&(s.scale=t[3]),e.$set(s)},i(o){n||(D(e.$$.fragment,o),n=!0)},o(o){V(e.$$.fragment,o),n=!1},d(o){et(e,o)}}}function oo(t){let e,n,o,r,s,i,c,a,l,p,f,d=ze(t[4].points),g=[];for(let h=0;h<d.length;h+=1)g[h]=Ue(Ge(t,d,h));const y=h=>V(g[h],1,1,()=>{g[h]=null});return{c(){e=z("polygon"),r=B(),s=z("polygon"),c=B();for(let h=0;h<g.length;h+=1)g[h].c();a=Me(),u(e,"class","a9s-outer"),u(e,"style",n=t[1]?"display:none;":void 0),u(e,"points",o=t[4].points.map(Xe).join(" ")),u(s,"class","a9s-inner a9s-shape-handle"),u(s,"style",t[1]),u(s,"points",i=t[4].points.map(Re).join(" "))},m(h,m){T(h,e,m),T(h,r,m),T(h,s,m),T(h,c,m);for(let b=0;b<g.length;b+=1)g[b]&&g[b].m(h,m);T(h,a,m),l=!0,p||(f=[I(e,"pointerdown",function(){M(t[9]("SHAPE"))&&t[9]("SHAPE").apply(this,arguments)}),I(s,"pointerdown",function(){M(t[9]("SHAPE"))&&t[9]("SHAPE").apply(this,arguments)})],p=!0)},p(h,m){if(t=h,(!l||m&2&&n!==(n=t[1]?"display:none;":void 0))&&u(e,"style",n),(!l||m&16&&o!==(o=t[4].points.map(Xe).join(" ")))&&u(e,"points",o),(!l||m&2)&&u(s,"style",t[1]),(!l||m&16&&i!==(i=t[4].points.map(Re).join(" ")))&&u(s,"points",i),m&536){d=ze(t[4].points);let b;for(b=0;b<d.length;b+=1){const x=Ge(t,d,b);g[b]?(g[b].p(x,m),D(g[b],1)):(g[b]=Ue(x),g[b].c(),D(g[b],1),g[b].m(a.parentNode,a))}for(Vn(),b=d.length;b<g.length;b+=1)y(b);Wn()}},i(h){if(!l){for(let m=0;m<d.length;m+=1)D(g[m]);l=!0}},o(h){g=g.filter(Boolean);for(let m=0;m<g.length;m+=1)V(g[m]);l=!1},d(h){h&&(S(e),S(r),S(s),S(c),S(a)),Un(g,h),p=!1,Q(f)}}}function ro(t){let e,n;return e=new Ce({props:{shape:t[0],transform:t[2],editor:t[5],$$slots:{default:[oo,({grab:o})=>({9:o}),({grab:o})=>o?512:0]},$$scope:{ctx:t}}}),e.$on("change",t[6]),e.$on("grab",t[7]),e.$on("release",t[8]),{c(){dt(e.$$.fragment)},m(o,r){tt(e,o,r),n=!0},p(o,[r]){const s={};r&1&&(s.shape=o[0]),r&4&&(s.transform=o[2]),r&8730&&(s.$$scope={dirty:r,ctx:o}),e.$set(s)},i(o){n||(D(e.$$.fragment,o),n=!0)},o(o){V(e.$$.fragment,o),n=!1},d(o){et(e,o)}}}const Xe=t=>t.join(","),Re=t=>t.join(",");function io(t,e,n){let o,{shape:r}=e,{computedStyle:s}=e,{transform:i}=e,{viewportScale:c=1}=e;const a=(d,g,y)=>{let h;const m=d.geometry;g==="SHAPE"?h=m.points.map(([x,w])=>[x+y[0],w+y[1]]):h=m.points.map(([x,w],O)=>g===`HANDLE-${O}`?[x+y[0],w+y[1]]:[x,w]);const b=Qn(h);return{...d,geometry:{points:h,bounds:b}}};function l(d){Z.call(this,t,d)}function p(d){Z.call(this,t,d)}function f(d){Z.call(this,t,d)}return t.$$set=d=>{"shape"in d&&n(0,r=d.shape),"computedStyle"in d&&n(1,s=d.computedStyle),"transform"in d&&n(2,i=d.transform),"viewportScale"in d&&n(3,c=d.viewportScale)},t.$$.update=()=>{t.$$.dirty&1&&n(4,o=r.geometry)},[r,s,i,c,o,a,l,p,f]}class so extends Dt{constructor(e){super(),Rt(this,e,io,ro,Gt,{shape:0,computedStyle:1,transform:2,viewportScale:3})}}const ao="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;function co(t){let e,n,o,r,s,i;return{c(){e=z("rect"),u(e,"class",n=Ut(`a9s-handle ${t[8].class||""}`.trim())+" svelte-1sgkh33"),u(e,"x",o=t[0]-t[5]/2),u(e,"y",r=t[1]-t[5]/2),u(e,"width",t[5]),u(e,"height",t[5])},m(c,a){T(c,e,a),s||(i=I(e,"pointerdown",t[11]),s=!0)},p(c,a){a&256&&n!==(n=Ut(`a9s-handle ${c[8].class||""}`.trim())+" svelte-1sgkh33")&&u(e,"class",n),a&33&&o!==(o=c[0]-c[5]/2)&&u(e,"x",o),a&34&&r!==(r=c[1]-c[5]/2)&&u(e,"y",r),a&32&&u(e,"width",c[5]),a&32&&u(e,"height",c[5])},d(c){c&&S(e),s=!1,i()}}}function lo(t){let e,n,o,r,s,i,c,a,l;return{c(){e=z("g"),n=z("circle"),r=z("rect"),u(n,"cx",t[0]),u(n,"cy",t[1]),u(n,"r",o=t[3]/t[2]),u(n,"class","a9s-touch-halo svelte-1sgkh33"),ke(n,"touched",t[4]),u(r,"class",s=Ut(`a9s-handle ${t[8].class||""}`.trim())+" svelte-1sgkh33"),u(r,"x",i=t[0]-t[5]/2),u(r,"y",c=t[1]-t[5]/2),u(r,"width",t[5]),u(r,"height",t[5]),u(e,"class","a9s-touch-handle")},m(p,f){T(p,e,f),Ae(e,n),Ae(e,r),a||(l=[I(n,"pointerdown",t[10]),I(n,"pointerdown",t[6]),I(n,"pointerup",t[7]),I(r,"pointerdown",t[9]),I(r,"pointerdown",t[6]),I(r,"pointerup",t[7])],a=!0)},p(p,f){f&1&&u(n,"cx",p[0]),f&2&&u(n,"cy",p[1]),f&12&&o!==(o=p[3]/p[2])&&u(n,"r",o),f&16&&ke(n,"touched",p[4]),f&256&&s!==(s=Ut(`a9s-handle ${p[8].class||""}`.trim())+" svelte-1sgkh33")&&u(r,"class",s),f&33&&i!==(i=p[0]-p[5]/2)&&u(r,"x",i),f&34&&c!==(c=p[1]-p[5]/2)&&u(r,"y",c),f&32&&u(r,"width",p[5]),f&32&&u(r,"height",p[5])},d(p){p&&S(e),a=!1,Q(l)}}}function fo(t){let e;function n(r,s){return ao?lo:co}let o=n()(t);return{c(){o.c(),e=Me()},m(r,s){o.m(r,s),T(r,e,s)},p(r,[s]){o.p(r,s)},i:Lt,o:Lt,d(r){r&&S(e),o.d(r)}}}function uo(t,e,n){let o,{x:r}=e,{y:s}=e,{scale:i}=e,{radius:c=30}=e,a=!1;const l=y=>{y.pointerType==="touch"&&n(4,a=!0)},p=()=>n(4,a=!1);function f(y){Z.call(this,t,y)}function d(y){Z.call(this,t,y)}function g(y){Z.call(this,t,y)}return t.$$set=y=>{n(8,e=oe(oe({},e),Pe(y))),"x"in y&&n(0,r=y.x),"y"in y&&n(1,s=y.y),"scale"in y&&n(2,i=y.scale),"radius"in y&&n(3,c=y.radius)},t.$$.update=()=>{t.$$.dirty&4&&n(5,o=10/i)},e=Pe(e),[r,s,i,c,a,o,l,p,e,f,d,g]}class At extends Dt{constructor(e){super(),Rt(this,e,uo,fo,Gt,{x:0,y:1,scale:2,radius:3})}}function po(t){let e,n,o,r,s,i,c,a,l,p,f,d,g,y,h,m,b,x,w,O,k,j,G,L,J,wt,Ct,ce,C,Ft,Bt,jt,le,nt,fe,ot,ue,rt,de,it,E,pe,Qe;return nt=new At({props:{class:"a9s-corner-handle-topleft",x:t[4].x,y:t[4].y,scale:t[3]}}),nt.$on("pointerdown",function(){M(t[9]("TOP_LEFT"))&&t[9]("TOP_LEFT").apply(this,arguments)}),ot=new At({props:{class:"a9s-corner-handle-topright",x:t[4].x+t[4].w,y:t[4].y,scale:t[3]}}),ot.$on("pointerdown",function(){M(t[9]("TOP_RIGHT"))&&t[9]("TOP_RIGHT").apply(this,arguments)}),rt=new At({props:{class:"a9s-corner-handle-bottomright",x:t[4].x+t[4].w,y:t[4].y+t[4].h,scale:t[3]}}),rt.$on("pointerdown",function(){M(t[9]("BOTTOM_RIGHT"))&&t[9]("BOTTOM_RIGHT").apply(this,arguments)}),it=new At({props:{class:"a9s-corner-handle-bottomleft",x:t[4].x,y:t[4].y+t[4].h,scale:t[3]}}),it.$on("pointerdown",function(){M(t[9]("BOTTOM_LEFT"))&&t[9]("BOTTOM_LEFT").apply(this,arguments)}),{c(){e=z("rect"),c=B(),a=z("rect"),g=B(),y=z("rect"),x=B(),w=z("rect"),G=B(),L=z("rect"),ce=B(),C=z("rect"),le=B(),dt(nt.$$.fragment),fe=B(),dt(ot.$$.fragment),ue=B(),dt(rt.$$.fragment),de=B(),dt(it.$$.fragment),u(e,"class","a9s-outer"),u(e,"style",n=t[1]?"display:none;":void 0),u(e,"x",o=t[4].x),u(e,"y",r=t[4].y),u(e,"width",s=t[4].w),u(e,"height",i=t[4].h),u(a,"class","a9s-inner a9s-shape-handle"),u(a,"style",t[1]),u(a,"x",l=t[4].x),u(a,"y",p=t[4].y),u(a,"width",f=t[4].w),u(a,"height",d=t[4].h),u(y,"class","a9s-edge-handle a9s-edge-handle-top"),u(y,"x",h=t[4].x),u(y,"y",m=t[4].y),u(y,"height",1),u(y,"width",b=t[4].w),u(w,"class","a9s-edge-handle a9s-edge-handle-right"),u(w,"x",O=t[4].x+t[4].w),u(w,"y",k=t[4].y),u(w,"height",j=t[4].h),u(w,"width",1),u(L,"class","a9s-edge-handle a9s-edge-handle-bottom"),u(L,"x",J=t[4].x),u(L,"y",wt=t[4].y+t[4].h),u(L,"height",1),u(L,"width",Ct=t[4].w),u(C,"class","a9s-edge-handle a9s-edge-handle-left"),u(C,"x",Ft=t[4].x),u(C,"y",Bt=t[4].y),u(C,"height",jt=t[4].h),u(C,"width",1)},m($,_){T($,e,_),T($,c,_),T($,a,_),T($,g,_),T($,y,_),T($,x,_),T($,w,_),T($,G,_),T($,L,_),T($,ce,_),T($,C,_),T($,le,_),tt(nt,$,_),T($,fe,_),tt(ot,$,_),T($,ue,_),tt(rt,$,_),T($,de,_),tt(it,$,_),E=!0,pe||(Qe=[I(e,"pointerdown",function(){M(t[9]("SHAPE"))&&t[9]("SHAPE").apply(this,arguments)}),I(a,"pointerdown",function(){M(t[9]("SHAPE"))&&t[9]("SHAPE").apply(this,arguments)}),I(y,"pointerdown",function(){M(t[9]("TOP"))&&t[9]("TOP").apply(this,arguments)}),I(w,"pointerdown",function(){M(t[9]("RIGHT"))&&t[9]("RIGHT").apply(this,arguments)}),I(L,"pointerdown",function(){M(t[9]("BOTTOM"))&&t[9]("BOTTOM").apply(this,arguments)}),I(C,"pointerdown",function(){M(t[9]("LEFT"))&&t[9]("LEFT").apply(this,arguments)})],pe=!0)},p($,_){t=$,(!E||_&2&&n!==(n=t[1]?"display:none;":void 0))&&u(e,"style",n),(!E||_&16&&o!==(o=t[4].x))&&u(e,"x",o),(!E||_&16&&r!==(r=t[4].y))&&u(e,"y",r),(!E||_&16&&s!==(s=t[4].w))&&u(e,"width",s),(!E||_&16&&i!==(i=t[4].h))&&u(e,"height",i),(!E||_&2)&&u(a,"style",t[1]),(!E||_&16&&l!==(l=t[4].x))&&u(a,"x",l),(!E||_&16&&p!==(p=t[4].y))&&u(a,"y",p),(!E||_&16&&f!==(f=t[4].w))&&u(a,"width",f),(!E||_&16&&d!==(d=t[4].h))&&u(a,"height",d),(!E||_&16&&h!==(h=t[4].x))&&u(y,"x",h),(!E||_&16&&m!==(m=t[4].y))&&u(y,"y",m),(!E||_&16&&b!==(b=t[4].w))&&u(y,"width",b),(!E||_&16&&O!==(O=t[4].x+t[4].w))&&u(w,"x",O),(!E||_&16&&k!==(k=t[4].y))&&u(w,"y",k),(!E||_&16&&j!==(j=t[4].h))&&u(w,"height",j),(!E||_&16&&J!==(J=t[4].x))&&u(L,"x",J),(!E||_&16&&wt!==(wt=t[4].y+t[4].h))&&u(L,"y",wt),(!E||_&16&&Ct!==(Ct=t[4].w))&&u(L,"width",Ct),(!E||_&16&&Ft!==(Ft=t[4].x))&&u(C,"x",Ft),(!E||_&16&&Bt!==(Bt=t[4].y))&&u(C,"y",Bt),(!E||_&16&&jt!==(jt=t[4].h))&&u(C,"height",jt);const Yt={};_&16&&(Yt.x=t[4].x),_&16&&(Yt.y=t[4].y),_&8&&(Yt.scale=t[3]),nt.$set(Yt);const Vt={};_&16&&(Vt.x=t[4].x+t[4].w),_&16&&(Vt.y=t[4].y),_&8&&(Vt.scale=t[3]),ot.$set(Vt);const Wt={};_&16&&(Wt.x=t[4].x+t[4].w),_&16&&(Wt.y=t[4].y+t[4].h),_&8&&(Wt.scale=t[3]),rt.$set(Wt);const qt={};_&16&&(qt.x=t[4].x),_&16&&(qt.y=t[4].y+t[4].h),_&8&&(qt.scale=t[3]),it.$set(qt)},i($){E||(D(nt.$$.fragment,$),D(ot.$$.fragment,$),D(rt.$$.fragment,$),D(it.$$.fragment,$),E=!0)},o($){V(nt.$$.fragment,$),V(ot.$$.fragment,$),V(rt.$$.fragment,$),V(it.$$.fragment,$),E=!1},d($){$&&(S(e),S(c),S(a),S(g),S(y),S(x),S(w),S(G),S(L),S(ce),S(C),S(le),S(fe),S(ue),S(de)),et(nt,$),et(ot,$),et(rt,$),et(it,$),pe=!1,Q(Qe)}}}function ho(t){let e,n;return e=new Ce({props:{shape:t[0],transform:t[2],editor:t[5],$$slots:{default:[po,({grab:o})=>({9:o}),({grab:o})=>o?512:0]},$$scope:{ctx:t}}}),e.$on("grab",t[6]),e.$on("change",t[7]),e.$on("release",t[8]),{c(){dt(e.$$.fragment)},m(o,r){tt(e,o,r),n=!0},p(o,[r]){const s={};r&1&&(s.shape=o[0]),r&4&&(s.transform=o[2]),r&1562&&(s.$$scope={dirty:r,ctx:o}),e.$set(s)},i(o){n||(D(e.$$.fragment,o),n=!0)},o(o){V(e.$$.fragment,o),n=!1},d(o){et(e,o)}}}function go(t,e,n){let o,{shape:r}=e,{computedStyle:s}=e,{transform:i}=e,{viewportScale:c=1}=e;const a=(d,g,y)=>{const h=d.geometry.bounds;let[m,b]=[h.minX,h.minY],[x,w]=[h.maxX,h.maxY];const[O,k]=y;if(g==="SHAPE")m+=O,x+=O,b+=k,w+=k;else{switch(g){case"TOP":case"TOP_LEFT":case"TOP_RIGHT":{b+=k;break}case"BOTTOM":case"BOTTOM_LEFT":case"BOTTOM_RIGHT":{w+=k;break}}switch(g){case"LEFT":case"TOP_LEFT":case"BOTTOM_LEFT":{m+=O;break}case"RIGHT":case"TOP_RIGHT":case"BOTTOM_RIGHT":{x+=O;break}}}const j=Math.min(m,x),G=Math.min(b,w),L=Math.abs(x-m),J=Math.abs(w-b);return{...d,geometry:{x:j,y:G,w:L,h:J,bounds:{minX:j,minY:G,maxX:j+L,maxY:G+J}}}};function l(d){Z.call(this,t,d)}function p(d){Z.call(this,t,d)}function f(d){Z.call(this,t,d)}return t.$$set=d=>{"shape"in d&&n(0,r=d.shape),"computedStyle"in d&&n(1,s=d.computedStyle),"transform"in d&&n(2,i=d.transform),"viewportScale"in d&&n(3,c=d.viewportScale)},t.$$.update=()=>{t.$$.dirty&1&&n(4,o=r.geometry)},[r,s,i,c,o,a,l,p,f]}class mo extends Dt{constructor(e){super(),Rt(this,e,go,ho,Gt,{shape:0,computedStyle:1,transform:2,viewportScale:3})}}W.RECTANGLE,W.POLYGON;const yo=t=>({}),De=t=>({grab:t[0]});function _o(t){let e,n,o,r;const s=t[7].default,i=Hn(s,t,t[6],De);return{c(){e=z("g"),i&&i.c(),u(e,"class","a9s-annotation selected")},m(c,a){T(c,e,a),i&&i.m(e,null),n=!0,o||(r=[I(e,"pointerup",t[2]),I(e,"pointermove",t[1])],o=!0)},p(c,[a]){i&&i.p&&(!n||a&64)&&zn(i,s,c,c[6],n?vn(s,c[6],a,yo):Gn(c[6]),De)},i(c){n||(D(i,c),n=!0)},o(c){V(i,c),n=!1},d(c){c&&S(e),i&&i.d(c),o=!1,Q(r)}}}function bo(t,e,n){let{$$slots:o={},$$scope:r}=e;const s=Cn();let{shape:i}=e,{editor:c}=e,{transform:a}=e,l,p,f;const d=h=>m=>{l=h,p=a.elementToImage(m.offsetX,m.offsetY),f=i,m.target.setPointerCapture(m.pointerId),s("grab",m)},g=h=>{if(l){const[m,b]=a.elementToImage(h.offsetX,h.offsetY),x=[m-p[0],b-p[1]];n(3,i=c(f,l,x)),s("change",i)}},y=h=>{h.target.releasePointerCapture(h.pointerId),l=void 0,f=i,s("release",h)};return t.$$set=h=>{"shape"in h&&n(3,i=h.shape),"editor"in h&&n(4,c=h.editor),"transform"in h&&n(5,a=h.transform),"$$scope"in h&&n(6,r=h.$$scope)},[d,g,y,i,c,a,r,o]}class Ce extends Dt{constructor(e){super(),Rt(this,e,bo,_o,Gt,{shape:3,editor:4,transform:5})}}navigator.userAgent.indexOf("Mac OS X");const Fe=t=>new Promise(e=>{var n;if((n=t.world.getItemAt(0))!=null&&n.source){const{x:o,y:r}=t.world.getItemAt(0).source.dimensions;e({width:o,height:r})}else{const o=()=>{const{x:r,y:s}=t.world.getItemAt(0).source.dimensions;t.removeHandler("open",o),e({width:r,height:s})};t.addHandler("open",o)}}),wo=(t,e,n)=>{const{bounds:o}=t.geometry,r=o.minX*e,s=o.minY*n,i=o.maxX*e,c=o.maxY*n;return t.type===W.RECTANGLE?{type:W.RECTANGLE,geometry:{bounds:{minX:r,minY:s,maxX:i,maxY:c},x:r,y:s,w:i-r,h:c-s}}:t.type===W.POLYGON?{type:W.POLYGON,geometry:{bounds:{minX:r,minY:s,maxX:i,maxY:c},points:t.geometry.points.map(([a,l])=>[a*e,l*n])}}:(console.error("Unsupported shape type",t),t)},$o=(t,e,n)=>{const o=e.width,r=e.height,s=n.width,i=n.height;if(o&&r){const c=s/o,a=i/r;return c===1&&a===1?{scaled:t,scaleX:c,scaleY:a}:(console.log("[TextLayerExtension] Page and image are different size - scaling annotations"),{scaled:t.map(p=>({...p,target:{...p.target,selector:wo(p.target.selector,c,a)}})),scaleX:c,scaleY:a})}else return console.warn("[TextLayerExtension] Cannot scale annotations without page dimensions"),{scaled:t,scaleX:1,scaleY:1}};function Be(t,e,n){const o=t.slice();return o[13]=e[n],o}function je(t,e,n){const o=t.slice();return o[13]=e[n],o}function Ye(t,e,n){const o=t.slice();return o[13]=e[n],o}function Ve(t){let e,n,o,r,s;const i=[So,Eo,xo],c=[];function a(l,p){return l[0].mode==="fixedScreenSize"||!l[0].mode?0:l[0].mode==="fixedPageSize"?1:l[0].mode==="fillBounds"?2:-1}return~(n=a(t))&&(o=c[n]=i[n](t)),{c(){e=at("div"),o&&o.c(),X(e,"style",r=`transform:${t[3]}; width: ${t[6]}px; height: ${t[7]}px; font-size: ${t[8]}px;`),X(e,"class","a9s-annotationlayer a9s-osd-textlayer"),R(e,"fixed-screen-size",t[0].mode==="fixedScreenSize"||!t[0].mode),R(e,"fixed-page-size",t[0].mode==="fixedPageSize"),R(e,"fill-bounds",t[0].mode==="fillBounds"),R(e,"bottomleft",t[0].position!=="topleft"),R(e,"topleft",t[0].position==="topleft"),R(e,"pointer-events",t[2])},m(l,p){F(l,e,p),~n&&c[n].m(e,null),s=!0},p(l,p){let f=n;n=a(l),n===f?~n&&c[n].p(l,p):(o&&(St(),v(c[f],1,1,()=>{c[f]=null}),Tt()),~n?(o=c[n],o?o.p(l,p):(o=c[n]=i[n](l),o.c()),P(o,1),o.m(e,null)):o=null),(!s||p&456&&r!==(r=`transform:${l[3]}; width: ${l[6]}px; height: ${l[7]}px; font-size: ${l[8]}px;`))&&X(e,"style",r),(!s||p&1)&&R(e,"fixed-screen-size",l[0].mode==="fixedScreenSize"||!l[0].mode),(!s||p&1)&&R(e,"fixed-page-size",l[0].mode==="fixedPageSize"),(!s||p&1)&&R(e,"fill-bounds",l[0].mode==="fillBounds"),(!s||p&1)&&R(e,"bottomleft",l[0].position!=="topleft"),(!s||p&1)&&R(e,"topleft",l[0].position==="topleft"),(!s||p&4)&&R(e,"pointer-events",l[2])},i(l){s||(P(o),s=!0)},o(l){v(o),s=!1},d(l){l&&U(e),~n&&c[n].d()}}}function xo(t){let e,n,o=mt(t[5]),r=[];for(let i=0;i<o.length;i+=1)r[i]=We(Be(t,o,i));const s=i=>v(r[i],1,1,()=>{r[i]=null});return{c(){for(let i=0;i<r.length;i+=1)r[i].c();e=lt()},m(i,c){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(i,c);F(i,e,c),n=!0},p(i,c){if(c&33){o=mt(i[5]);let a;for(a=0;a<o.length;a+=1){const l=Be(i,o,a);r[a]?(r[a].p(l,c),P(r[a],1)):(r[a]=We(l),r[a].c(),P(r[a],1),r[a].m(e.parentNode,e))}for(St(),a=o.length;a<r.length;a+=1)s(a);Tt()}},i(i){if(!n){for(let c=0;c<o.length;c+=1)P(r[c]);n=!0}},o(i){r=r.filter(Boolean);for(let c=0;c<r.length;c+=1)v(r[c]);n=!1},d(i){i&&U(e),Qt(r,i)}}}function Eo(t){let e,n,o=mt(t[5]),r=[];for(let i=0;i<o.length;i+=1)r[i]=qe(je(t,o,i));const s=i=>v(r[i],1,1,()=>{r[i]=null});return{c(){for(let i=0;i<r.length;i+=1)r[i].c();e=lt()},m(i,c){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(i,c);F(i,e,c),n=!0},p(i,c){if(c&33){o=mt(i[5]);let a;for(a=0;a<o.length;a+=1){const l=je(i,o,a);r[a]?(r[a].p(l,c),P(r[a],1)):(r[a]=qe(l),r[a].c(),P(r[a],1),r[a].m(e.parentNode,e))}for(St(),a=o.length;a<r.length;a+=1)s(a);Tt()}},i(i){if(!n){for(let c=0;c<o.length;c+=1)P(r[c]);n=!0}},o(i){r=r.filter(Boolean);for(let c=0;c<r.length;c+=1)v(r[c]);n=!1},d(i){i&&U(e),Qt(r,i)}}}function So(t){let e,n,o=mt(t[5]),r=[];for(let i=0;i<o.length;i+=1)r[i]=Ke(Ye(t,o,i));const s=i=>v(r[i],1,1,()=>{r[i]=null});return{c(){for(let i=0;i<r.length;i+=1)r[i].c();e=lt()},m(i,c){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(i,c);F(i,e,c),n=!0},p(i,c){if(c&241){o=mt(i[5]);let a;for(a=0;a<o.length;a+=1){const l=Ye(i,o,a);r[a]?(r[a].p(l,c),P(r[a],1)):(r[a]=Ke(l),r[a].c(),P(r[a],1),r[a].m(e.parentNode,e))}for(St(),a=o.length;a<r.length;a+=1)s(a);Tt()}},i(i){if(!n){for(let c=0;c<o.length;c+=1)P(r[c]);n=!0}},o(i){r=r.filter(Boolean);for(let c=0;c<r.length;c+=1)v(r[c]);n=!1},d(i){i&&U(e),Qt(r,i)}}}function We(t){let e,n;return e=new Sn({props:{annotation:t[13],opts:t[0]}}),{c(){ne(e.$$.fragment)},m(o,r){Nt(e,o,r),n=!0},p(o,r){const s={};r&32&&(s.annotation=o[13]),r&1&&(s.opts=o[0]),e.$set(s)},i(o){n||(P(e.$$.fragment,o),n=!0)},o(o){v(e.$$.fragment,o),n=!1},d(o){Ht(e,o)}}}function qe(t){let e,n;return e=new On({props:{annotation:t[13],opts:t[0]}}),{c(){ne(e.$$.fragment)},m(o,r){Nt(e,o,r),n=!0},p(o,r){const s={};r&32&&(s.annotation=o[13]),r&1&&(s.opts=o[0]),e.$set(s)},i(o){n||(P(e.$$.fragment,o),n=!0)},o(o){v(e.$$.fragment,o),n=!1},d(o){Ht(e,o)}}}function Ke(t){let e,n;return e=new In({props:{annotation:t[13],opts:t[0],imageSize:[t[6],t[7]],scale:t[4]}}),{c(){ne(e.$$.fragment)},m(o,r){Nt(e,o,r),n=!0},p(o,r){const s={};r&32&&(s.annotation=o[13]),r&1&&(s.opts=o[0]),r&192&&(s.imageSize=[o[6],o[7]]),r&16&&(s.scale=o[4]),e.$set(s)},i(o){n||(P(e.$$.fragment,o),n=!0)},o(o){v(e.$$.fragment,o),n=!1},d(o){Ht(e,o)}}}function To(t){let e,n,o=t[1]&&Ve(t);return{c(){o&&o.c(),e=lt()},m(r,s){o&&o.m(r,s),F(r,e,s),n=!0},p(r,[s]){r[1]?o?(o.p(r,s),s&2&&P(o,1)):(o=Ve(r),o.c(),P(o,1),o.m(e.parentNode,e)):o&&(St(),v(o,1,1,()=>{o=null}),Tt())},i(r){n||(P(o),n=!0)},o(r){v(o),n=!1},d(r){r&&U(e),o&&o.d(r)}}}function Lo(t,e,n){let o,{state:r}=e,{viewer:s}=e,{opts:i}=e,{visible:c=!0}=e,{captureEvents:a=!1}=e;const{store:l}=r;let p,f,d=[],g,y;const h=()=>{const m=s.viewport.viewportToImageRectangle(s.viewport.getBounds(!0)),b=s.viewport.getContainerSize().x,x=s.viewport.getZoom(!0);n(4,f=x*b/s.world.getContentFactor());let w=Math.PI*s.viewport.getRotation(!0)/180;w<0&&(w+=2*Math.PI),w>2*Math.PI&&(w-=2*Math.PI);const O=s.viewport.getFlip(),k=O?s.viewport._containerInnerSize.x+m.x*f:-m.x*f,j=-m.y*f;let G,L;w>0&&w<=Math.PI/2?(G=m.height*f,L=0):w>Math.PI/2&&w<=Math.PI?(G=m.width*f,L=m.height*f):w>Math.PI&&w<=Math.PI*1.5?(G=0,L=m.width*f):(G=0,L=0);const J=Math.round(100*(G+k*Math.cos(w)-j*Math.sin(w)))/100,wt=Math.round(100*(L+k*Math.sin(w)+j*Math.cos(w)))/100;n(3,p=`translate(${J}px, ${wt}px) rotate(${w}rad) scaleX(${O?-f:f}) scaleY(${f})`)};return gn(()=>{Fe(s).then(x=>{n(6,g=x.width),n(7,y=x.height)}),s.addHandler("update-viewport",h);const m=x=>{n(5,d=x.state),h()};l.observe(m);const b=x=>{const w=document.getSelection().toString(),O=x.clipboardData||window.clipboardData;O.setData("text/plain",w),O.setData("text/html",w),x.preventDefault()};return document.addEventListener("copy",b),()=>{s.removeHandler("update-viewport",h),l.unobserve(m),document.removeEventListener("copy",b)}}),t.$$set=m=>{"state"in m&&n(9,r=m.state),"viewer"in m&&n(10,s=m.viewer),"opts"in m&&n(0,i=m.opts),"visible"in m&&n(1,c=m.visible),"captureEvents"in m&&n(2,a=m.captureEvents)},t.$$.update=()=>{t.$$.dirty&1&&n(8,o=i.fontSize||16)},[i,c,a,p,f,d,g,y,o,r,s]}class Oo extends zt{constructor(e){super(),vt(this,e,Lo,To,It,{state:9,viewer:10,opts:0,visible:1,captureEvents:2})}}const Po=(t,e)=>{const{viewer:n,state:o}=t;let r=e.defaultVisible===void 0?!0:e.defaultVisible,s=!1;const i=new Oo({target:n.element.querySelector(".openseadragon-canvas"),props:{state:o,viewer:n,opts:e,visible:r}});return{isLocked:()=>s,isVisible:()=>r,loadOCR:(g,y="ALTO")=>fetch(g).then(h=>h.text()).then(h=>{const{annotations:m,metadata:b}=un(h);Fe(n).then(x=>{const{scaled:w,scaleY:O}=$o(m,b,x);if(!e.fontSize&&b.averageLineHeight){const k=b.averageLineHeight*O*.5;i.$set({opts:{...e,fontSize:k}})}t.setAnnotations(w)})}),setLocked:g=>{s=g,n.setMouseNavEnabled(!g),i.$set({captureEvents:g})},setVisible:g=>{r=g,i.$set({visible:g})},unmount:()=>i.$destroy()}};N.mountExtension=Po,N.transcriptionLabel=H,Object.defineProperty(N,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=annotorious-openseadragon-textlayer.js.map
