(function(Y,H){typeof exports=="object"&&typeof module<"u"?H(exports):typeof define=="function"&&define.amd?define(["exports"],H):(Y=typeof globalThis<"u"?globalThis:Y||self,H(Y.OSDTextLayer={}))})(this,function(Y){"use strict";var Io=Object.defineProperty;var Mo=(Y,H,V)=>H in Y?Io(Y,H,{enumerable:!0,configurable:!0,writable:!0,value:V}):Y[H]=V;var pe=(Y,H,V)=>(Mo(Y,typeof H!="symbol"?H+"":H,V),V);const H=t=>{var e;return(e=t.bodies.find(n=>n.purpose==="transcribing"))==null?void 0:e.value};let V;const Ke=new Uint8Array(16);function Qe(){if(!V&&(V=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!V))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return V(Ke)}const A=[];for(let t=0;t<256;++t)A.push((t+256).toString(16).slice(1));function tn(t,e=0){return A[t[e+0]]+A[t[e+1]]+A[t[e+2]]+A[t[e+3]]+"-"+A[t[e+4]]+A[t[e+5]]+"-"+A[t[e+6]]+A[t[e+7]]+"-"+A[t[e+8]]+A[t[e+9]]+"-"+A[t[e+10]]+A[t[e+11]]+A[t[e+12]]+A[t[e+13]]+A[t[e+14]]+A[t[e+15]]}const en=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ge={randomUUID:en};function nn(t,e,n){if(ge.randomUUID&&!e&&!t)return ge.randomUUID();t=t||{};const o=t.random||(t.rng||Qe)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,tn(o)}const on="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(on);var at=(t=>(t.ELLIPSE="ELLIPSE",t.POLYGON="POLYGON",t.RECTANGLE="RECTANGLE",t))(at||{});const Zt=(t,e)=>e,rn={area:t=>Math.PI*t.geometry.rx*t.geometry.ry,intersects:(t,e,n)=>{const{cx:o,cy:r,rx:s,ry:i}=t.geometry,l=0,a=Math.cos(l),c=Math.sin(l),h=e-o,f=n-r,u=a*h+c*f,g=c*h-a*f;return u*u/(s*s)+g*g/(i*i)<=1}};Zt(at.ELLIPSE,rn);const sn={area:t=>{const{points:e}=t.geometry;let n=0,o=e.length-1;for(let r=0;r<e.length;r++)n+=(e[o][0]+e[r][0])*(e[o][1]-e[r][1]),o=r;return Math.abs(.5*n)},intersects:(t,e,n)=>{const{points:o}=t.geometry;let r=!1;for(let s=0,i=o.length-1;s<o.length;i=s++){const l=o[s][0],a=o[s][1],c=o[i][0],h=o[i][1];a>n!=h>n&&e<(c-l)*(n-a)/(h-a)+l&&(r=!r)}return r}};Zt(at.POLYGON,sn);const an={area:t=>t.geometry.w*t.geometry.h,intersects:(t,e,n)=>e>=t.geometry.x&&e<=t.geometry.x+t.geometry.w&&n>=t.geometry.y&&n<=t.geometry.y+t.geometry.h};Zt(at.RECTANGLE,an);const ln=[];for(let t=0;t<256;++t)ln.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const cn=[];for(let t=0;t<256;++t)cn.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),((t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),""))(),at.RECTANGLE,at.POLYGON,navigator.userAgent.indexOf("Mac OS X");const fn=t=>{const e=[];let n=1/0,o=0,r=0,s=0,i=0,l=0;const a=t.querySelectorAll("String");for(const c of a){const h=c.getAttribute("ID")||nn(),f=c.getAttribute("CONTENT"),u=parseFloat(c.getAttribute("HPOS")),g=parseFloat(c.getAttribute("VPOS")),y=parseFloat(c.getAttribute("WIDTH")),p=parseFloat(c.getAttribute("HEIGHT")),m=u+y,b=g+p;u<n&&(n=u),m>o&&(o=m),r+=f.length,s+=1,i+=p,l+=y,e.push({id:h,bodies:[{id:h,annotation:h,purpose:"transcribing",value:f}],target:{annotation:h,selector:{type:at.RECTANGLE,geometry:{bounds:{minX:u,minY:g,maxX:m,maxY:b},x:u,y:g,w:y,h:p}}}})}return{annotations:e,avgWordHeight:i/a.length,avgWordWidth:l/a.length,lineWidth:o-n,numWords:s,numChars:r}},un=t=>{const e=[],n=new DOMParser().parseFromString(t,"application/xml"),o=n.querySelector("Page"),r=n.querySelectorAll("TextLine");let s=0,i=0,l=0,a=0,c=0;for(const O of r){const{annotations:M,avgWordHeight:v,avgWordWidth:N,lineWidth:L,numWords:j,numChars:nt}=fn(O);s+=v,i+=N,l+=L,a+=j,c+=nt,e.push(...M)}const h=o.getAttribute("ID"),f=parseFloat(o.getAttribute("HEIGHT")),u=parseFloat(o.getAttribute("WIDTH")),g=r.length,{length:y}=r,p=s/y,m=l/y,b=i/y,x=a/y,w=c/y;return{annotations:e,metadata:{id:h,height:f,width:u,avgLineHeight:p,avgLineWidth:m,avgWordWidth:b,avgWordsPerLine:x,avgCharsPerLine:w,numLines:g}}};function Z(){}function me(t){return t()}function ye(){return Object.create(null)}function $t(t){t.forEach(me)}function _e(t){return typeof t=="function"}function It(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function dn(t){return Object.keys(t).length===0}function J(t,e){t.appendChild(e)}function B(t,e,n){t.insertBefore(e,n||null)}function z(t){t.parentNode&&t.parentNode.removeChild(t)}function Jt(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function lt(t){return document.createElement(t)}function ct(t){return document.createTextNode(t)}function ft(){return ct("")}function X(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function hn(t){return Array.from(t.childNodes)}function Kt(t,e){e=""+e,t.data!==e&&(t.data=e)}function C(t,e,n){t.classList.toggle(e,!!n)}let xt;function Et(t){xt=t}function pn(){if(!xt)throw new Error("Function called outside component initialization");return xt}function gn(t){pn().$$.on_mount.push(t)}const pt=[],Mt=[];let gt=[];const be=[],mn=Promise.resolve();let Qt=!1;function yn(){Qt||(Qt=!0,mn.then(we))}function te(t){gt.push(t)}const ee=new Set;let mt=0;function we(){if(mt!==0)return;const t=xt;do{try{for(;mt<pt.length;){const e=pt[mt];mt++,Et(e),_n(e.$$)}}catch(e){throw pt.length=0,mt=0,e}for(Et(null),pt.length=0,mt=0;Mt.length;)Mt.pop()();for(let e=0;e<gt.length;e+=1){const n=gt[e];ee.has(n)||(ee.add(n),n())}gt.length=0}while(pt.length);for(;be.length;)be.pop()();Qt=!1,ee.clear(),Et(t)}function _n(t){if(t.fragment!==null){t.update(),$t(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(te)}}function bn(t){const e=[],n=[];gt.forEach(o=>t.indexOf(o)===-1?e.push(o):n.push(o)),n.forEach(o=>o()),gt=e}const kt=new Set;let ut;function St(){ut={r:0,c:[],p:ut}}function Tt(){ut.r||$t(ut.c),ut=ut.p}function P(t,e){t&&t.i&&(kt.delete(t),t.i(e))}function G(t,e,n,o){if(t&&t.o){if(kt.has(t))return;kt.add(t),ut.c.push(()=>{kt.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}else o&&o()}function yt(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function ne(t){t&&t.c()}function vt(t,e,n){const{fragment:o,after_update:r}=t.$$;o&&o.m(e,n),te(()=>{const s=t.$$.on_mount.map(me).filter(_e);t.$$.on_destroy?t.$$.on_destroy.push(...s):$t(s),t.$$.on_mount=[]}),r.forEach(te)}function Nt(t,e){const n=t.$$;n.fragment!==null&&(bn(n.after_update),$t(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function wn(t,e){t.$$.dirty[0]===-1&&(pt.push(t),yn(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Yt(t,e,n,o,r,s,i=null,l=[-1]){const a=xt;Et(t);const c=t.$$={fragment:null,ctx:[],props:s,update:Z,not_equal:r,bound:ye(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:ye(),dirty:l,skip_bound:!1,root:e.target||a.$$.root};i&&i(c.root);let h=!1;if(c.ctx=n?n(t,e.props||{},(f,u,...g)=>{const y=g.length?g[0]:u;return c.ctx&&r(c.ctx[f],c.ctx[f]=y)&&(!c.skip_bound&&c.bound[f]&&c.bound[f](y),h&&wn(t,f)),u}):[],c.update(),h=!0,$t(c.before_update),c.fragment=o?o(c.ctx):!1,e.target){if(e.hydrate){const f=hn(e.target);c.fragment&&c.fragment.l(f),f.forEach(z)}else c.fragment&&c.fragment.c();e.intro&&P(t.$$.fragment),vt(t,e.target,e.anchor),we()}Et(a)}class Ht{constructor(){pe(this,"$$");pe(this,"$$set")}$destroy(){Nt(this,1),this.$destroy=Z}$on(e,n){if(!_e(n))return Z;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const r=o.indexOf(n);r!==-1&&o.splice(r,1)}}$set(e){this.$$set&&!dn(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const $n="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add($n);function $e(t){let e,n,o,r,s;return{c(){e=lt("div"),n=lt("span"),o=ct(t[3]),r=ct(" "),X(e,"class","annotation"),X(e,"style",s=`left:${t[7]}px; top:${t[6]}px; width: ${t[2]}px; height: ${t[1]}px; transform: scale(${t[5]}, ${t[4]})`)},m(i,l){B(i,e,l),J(e,n),J(n,o),t[11](n),J(e,r)},p(i,l){l&8&&Kt(o,i[3]),l&246&&s!==(s=`left:${i[7]}px; top:${i[6]}px; width: ${i[2]}px; height: ${i[1]}px; transform: scale(${i[5]}, ${i[4]})`)&&X(e,"style",s)},d(i){i&&z(e),t[11](null)}}}function xn(t){let e,n=t[3]&&$e(t);return{c(){n&&n.c(),e=ft()},m(o,r){n&&n.m(o,r),B(o,e,r)},p(o,[r]){o[3]?n?n.p(o,r):(n=$e(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:Z,o:Z,d(o){o&&z(e),n&&n.d(o)}}}function En(t,e,n){let o,r,s,i,l,a,c,h,f,{annotation:u}=e,{opts:g}=e;function y(p){Mt[p?"unshift":"push"](()=>{f=p,n(0,f)})}return t.$$set=p=>{"annotation"in p&&n(8,u=p.annotation),"opts"in p&&n(9,g=p.opts)},t.$$.update=()=>{t.$$.dirty&256&&n(10,o=u.target.selector.geometry.bounds),t.$$.dirty&1024&&n(7,r=o.minX),t.$$.dirty&1024&&n(6,s=o.minY),t.$$.dirty&1024&&n(2,i=o.maxX-o.minX),t.$$.dirty&1024&&n(1,l=o.maxY-o.minY),t.$$.dirty&5&&n(5,a=f?i/f.offsetWidth:1),t.$$.dirty&3&&n(4,c=f?l/f.offsetHeight:1),t.$$.dirty&768&&n(3,h=g.label(u))},[f,l,i,h,c,a,s,r,u,g,o,y]}class Sn extends Ht{constructor(e){super(),Yt(this,e,En,xn,It,{annotation:8,opts:9})}}function xe(t){let e,n,o,r,s;return{c(){e=lt("div"),n=lt("span"),o=ct(t[1]),r=ct(" "),X(e,"class","annotation"),X(e,"style",s=t[3](t[2]))},m(i,l){B(i,e,l),J(e,n),J(n,o),t[6](n),J(e,r)},p(i,l){l&2&&Kt(o,i[1]),l&4&&s!==(s=i[3](i[2]))&&X(e,"style",s)},d(i){i&&z(e),t[6](null)}}}function Tn(t){let e,n=t[1]&&xe(t);return{c(){n&&n.c(),e=ft()},m(o,r){n&&n.m(o,r),B(o,e,r)},p(o,[r]){o[1]?n?n.p(o,r):(n=xe(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:Z,o:Z,d(o){o&&z(e),n&&n.d(o)}}}function Ln(t,e,n){let o,r,s,i,{annotation:l}=e,{opts:a}=e;const c=f=>{const u=a.offsetX||0,g=a.offsetY||0;if(a.position==="center"){const y=o.maxX-o.minX,p=o.minX+y/2-f[0]/2,m=o.maxY-o.minY,b=o.minY+m/2-f[1]/2;return`left:${p+u}px; top:${b+g}px;`}else return a.position==="topleft"?`left:${o.minX+u}px; top:${o.minY+g}px;`:`left:${o.minX+u}px; top:${o.maxY+g}px;`};function h(f){Mt[f?"unshift":"push"](()=>{i=f,n(0,i)})}return t.$$set=f=>{"annotation"in f&&n(4,l=f.annotation),"opts"in f&&n(5,a=f.opts)},t.$$.update=()=>{t.$$.dirty&16&&(o=l.target.selector.geometry.bounds),t.$$.dirty&1&&n(2,r=i?[i.offsetWidth,i.offsetHeight]:[0,0]),t.$$.dirty&48&&n(1,s=a.label(l))},[i,s,r,c,l,a,h]}class On extends Ht{constructor(e){super(),Yt(this,e,Ln,Tn,It,{annotation:4,opts:5})}}function Ee(t){let e,n,o,r,s;return{c(){e=lt("div"),n=lt("span"),o=ct(t[1]),r=ct(" "),X(e,"class","annotation"),X(e,"style",s=t[4](t[3],t[2],t[0]))},m(i,l){B(i,e,l),J(e,n),J(n,o),J(e,r)},p(i,l){l&2&&Kt(o,i[1]),l&13&&s!==(s=i[4](i[3],i[2],i[0]))&&X(e,"style",s)},d(i){i&&z(e)}}}function Pn(t){let e,n=t[1]&&Ee(t);return{c(){n&&n.c(),e=ft()},m(o,r){n&&n.m(o,r),B(o,e,r)},p(o,[r]){o[1]?n?n.p(o,r):(n=Ee(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:Z,o:Z,d(o){o&&z(e),n&&n.d(o)}}}function An(t,e,n){let o,r,s,i,{annotation:l}=e,{opts:a}=e,{scale:c}=e,{imageSize:h}=e;const f=(u,g,y)=>{const p=(a.offsetX||0)/y,m=(a.offsetY||0)/y;if(a.position==="topleft"){const b=h[1]-g;return`left:${u+p}px; bottom:${b}px; transform: scale(${1/y})`}else return`left:${u+p}px; top:${g+m}px; transform: scale(${1/y})`};return t.$$set=u=>{"annotation"in u&&n(5,l=u.annotation),"opts"in u&&n(6,a=u.opts),"scale"in u&&n(0,c=u.scale),"imageSize"in u&&n(7,h=u.imageSize)},t.$$.update=()=>{t.$$.dirty&32&&n(8,o=l.target.selector.geometry.bounds),t.$$.dirty&256&&n(3,r=o.minX),t.$$.dirty&320&&n(2,s=a.position==="topleft"?o.minY:o.maxY),t.$$.dirty&96&&n(1,i=a.label(l))},[c,i,s,r,f,l,a,h,o]}class In extends Ht{constructor(e){super(),Yt(this,e,An,Pn,It,{annotation:5,opts:6,scale:0,imageSize:7})}}var Mn=Object.defineProperty,kn=(t,e,n)=>e in t?Mn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Se=(t,e,n)=>(kn(t,typeof e!="symbol"?e+"":e,n),n);function Lt(){}function oe(t,e){for(const n in e)t[n]=e[n];return t}function Te(t){return t()}function Le(){return Object.create(null)}function K(t){t.forEach(Te)}function k(t){return typeof t=="function"}function Gt(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function vn(t){return Object.keys(t).length===0}function Nn(t,e,n,o){if(t){const r=Oe(t,e,n,o);return t[0](r)}}function Oe(t,e,n,o){return t[1]&&o?oe(n.ctx.slice(),t[1](o(e))):n.ctx}function Yn(t,e,n,o){if(t[2]&&o){const r=t[2](o(n));if(e.dirty===void 0)return r;if(typeof r=="object"){const s=[],i=Math.max(e.dirty.length,r.length);for(let l=0;l<i;l+=1)s[l]=e.dirty[l]|r[l];return s}return e.dirty|r}return e.dirty}function Hn(t,e,n,o,r,s){if(r){const i=Oe(e,n,o,s);t.p(i,r)}}function Gn(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let o=0;o<n;o++)e[o]=-1;return e}return-1}function Pe(t){const e={};for(const n in t)n[0]!=="$"&&(e[n]=t[n]);return e}function Ut(t){return t??""}function Ae(t,e){t.appendChild(e)}function T(t,e,n){t.insertBefore(e,n||null)}function S(t){t.parentNode&&t.parentNode.removeChild(t)}function Un(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function U(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Ie(t){return document.createTextNode(t)}function W(){return Ie(" ")}function Me(){return Ie("")}function I(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function d(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function zn(t){return Array.from(t.childNodes)}function ke(t,e,n){t.classList.toggle(e,!!n)}function Xn(t,e,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:o})}let Ot;function Pt(t){Ot=t}function Cn(){if(!Ot)throw new Error("Function called outside component initialization");return Ot}function Rn(){const t=Cn();return(e,n,{cancelable:o=!1}={})=>{const r=t.$$.callbacks[e];if(r){const s=Xn(e,n,{cancelable:o});return r.slice().forEach(i=>{i.call(t,s)}),!s.defaultPrevented}return!0}}function Q(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(o=>o.call(this,e))}const _t=[],ve=[];let bt=[];const Ne=[],Fn=Promise.resolve();let re=!1;function Bn(){re||(re=!0,Fn.then(Ye))}function ie(t){bt.push(t)}const se=new Set;let wt=0;function Ye(){if(wt!==0)return;const t=Ot;do{try{for(;wt<_t.length;){const e=_t[wt];wt++,Pt(e),Wn(e.$$)}}catch(e){throw _t.length=0,wt=0,e}for(Pt(null),_t.length=0,wt=0;ve.length;)ve.pop()();for(let e=0;e<bt.length;e+=1){const n=bt[e];se.has(n)||(se.add(n),n())}bt.length=0}while(_t.length);for(;Ne.length;)Ne.pop()();re=!1,se.clear(),Pt(t)}function Wn(t){if(t.fragment!==null){t.update(),K(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ie)}}function jn(t){const e=[],n=[];bt.forEach(o=>t.indexOf(o)===-1?e.push(o):n.push(o)),n.forEach(o=>o()),bt=e}const zt=new Set;let dt;function Vn(){dt={r:0,c:[],p:dt}}function qn(){dt.r||K(dt.c),dt=dt.p}function R(t,e){t&&t.i&&(zt.delete(t),t.i(e))}function q(t,e,n,o){if(t&&t.o){if(zt.has(t))return;zt.add(t),dt.c.push(()=>{zt.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}else o&&o()}function He(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function ht(t){t&&t.c()}function tt(t,e,n){const{fragment:o,after_update:r}=t.$$;o&&o.m(e,n),ie(()=>{const s=t.$$.on_mount.map(Te).filter(k);t.$$.on_destroy?t.$$.on_destroy.push(...s):K(s),t.$$.on_mount=[]}),r.forEach(ie)}function et(t,e){const n=t.$$;n.fragment!==null&&(jn(n.after_update),K(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Dn(t,e){t.$$.dirty[0]===-1&&(_t.push(t),Bn(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Xt(t,e,n,o,r,s,i=null,l=[-1]){const a=Ot;Pt(t);const c=t.$$={fragment:null,ctx:[],props:s,update:Lt,not_equal:r,bound:Le(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:Le(),dirty:l,skip_bound:!1,root:e.target||a.$$.root};i&&i(c.root);let h=!1;if(c.ctx=n?n(t,e.props||{},(f,u,...g)=>{const y=g.length?g[0]:u;return c.ctx&&r(c.ctx[f],c.ctx[f]=y)&&(!c.skip_bound&&c.bound[f]&&c.bound[f](y),h&&Dn(t,f)),u}):[],c.update(),h=!0,K(c.before_update),c.fragment=o?o(c.ctx):!1,e.target){if(e.hydrate){const f=zn(e.target);c.fragment&&c.fragment.l(f),f.forEach(S)}else c.fragment&&c.fragment.c();e.intro&&R(t.$$.fragment),tt(t,e.target,e.anchor),Ye()}Pt(a)}class Ct{constructor(){Se(this,"$$"),Se(this,"$$set")}$destroy(){et(this,1),this.$destroy=Lt}$on(e,n){if(!k(n))return Lt;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const r=o.indexOf(n);r!==-1&&o.splice(r,1)}}$set(e){this.$$set&&!vn(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Zn="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Zn);var D=(t=>(t.ELLIPSE="ELLIPSE",t.POLYGON="POLYGON",t.RECTANGLE="RECTANGLE",t))(D||{});const ae=(t,e)=>e,Jn=t=>{let e=1/0,n=1/0,o=-1/0,r=-1/0;return t.forEach(([s,i])=>{e=Math.min(e,s),n=Math.min(n,i),o=Math.max(o,s),r=Math.max(r,i)}),{minX:e,minY:n,maxX:o,maxY:r}},Kn={area:t=>Math.PI*t.geometry.rx*t.geometry.ry,intersects:(t,e,n)=>{const{cx:o,cy:r,rx:s,ry:i}=t.geometry,l=0,a=Math.cos(l),c=Math.sin(l),h=e-o,f=n-r,u=a*h+c*f,g=c*h-a*f;return u*u/(s*s)+g*g/(i*i)<=1}};ae(D.ELLIPSE,Kn);const Qn={area:t=>{const{points:e}=t.geometry;let n=0,o=e.length-1;for(let r=0;r<e.length;r++)n+=(e[o][0]+e[r][0])*(e[o][1]-e[r][1]),o=r;return Math.abs(.5*n)},intersects:(t,e,n)=>{const{points:o}=t.geometry;let r=!1;for(let s=0,i=o.length-1;s<o.length;i=s++){const l=o[s][0],a=o[s][1],c=o[i][0],h=o[i][1];a>n!=h>n&&e<(c-l)*(n-a)/(h-a)+l&&(r=!r)}return r}};ae(D.POLYGON,Qn);const to={area:t=>t.geometry.w*t.geometry.h,intersects:(t,e,n)=>e>=t.geometry.x&&e<=t.geometry.x+t.geometry.w&&n>=t.geometry.y&&n<=t.geometry.y+t.geometry.h};ae(D.RECTANGLE,to);const eo=[];for(let t=0;t<256;++t)eo.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const no=[];for(let t=0;t<256;++t)no.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const oo="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";((t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=oo[n[t]&63];return e})();function Ge(t,e,n){const o=t.slice();return o[10]=e[n],o[12]=n,o}function Ue(t){let e,n;return e=new At({props:{x:t[10][0],y:t[10][1],scale:t[3]}}),e.$on("pointerdown",function(){k(t[9](`HANDLE-${t[12]}`))&&t[9](`HANDLE-${t[12]}`).apply(this,arguments)}),{c(){ht(e.$$.fragment)},m(o,r){tt(e,o,r),n=!0},p(o,r){t=o;const s={};r&16&&(s.x=t[10][0]),r&16&&(s.y=t[10][1]),r&8&&(s.scale=t[3]),e.$set(s)},i(o){n||(R(e.$$.fragment,o),n=!0)},o(o){q(e.$$.fragment,o),n=!1},d(o){et(e,o)}}}function ro(t){let e,n,o,r,s,i,l,a,c,h,f,u=He(t[4].points),g=[];for(let p=0;p<u.length;p+=1)g[p]=Ue(Ge(t,u,p));const y=p=>q(g[p],1,1,()=>{g[p]=null});return{c(){e=U("polygon"),r=W(),s=U("polygon"),l=W();for(let p=0;p<g.length;p+=1)g[p].c();a=Me(),d(e,"class","a9s-outer"),d(e,"style",n=t[1]?"display:none;":void 0),d(e,"points",o=t[4].points.map(ze).join(" ")),d(s,"class","a9s-inner a9s-shape-handle"),d(s,"style",t[1]),d(s,"points",i=t[4].points.map(Xe).join(" "))},m(p,m){T(p,e,m),T(p,r,m),T(p,s,m),T(p,l,m);for(let b=0;b<g.length;b+=1)g[b]&&g[b].m(p,m);T(p,a,m),c=!0,h||(f=[I(e,"pointerdown",function(){k(t[9]("SHAPE"))&&t[9]("SHAPE").apply(this,arguments)}),I(s,"pointerdown",function(){k(t[9]("SHAPE"))&&t[9]("SHAPE").apply(this,arguments)})],h=!0)},p(p,m){if(t=p,(!c||m&2&&n!==(n=t[1]?"display:none;":void 0))&&d(e,"style",n),(!c||m&16&&o!==(o=t[4].points.map(ze).join(" ")))&&d(e,"points",o),(!c||m&2)&&d(s,"style",t[1]),(!c||m&16&&i!==(i=t[4].points.map(Xe).join(" ")))&&d(s,"points",i),m&536){u=He(t[4].points);let b;for(b=0;b<u.length;b+=1){const x=Ge(t,u,b);g[b]?(g[b].p(x,m),R(g[b],1)):(g[b]=Ue(x),g[b].c(),R(g[b],1),g[b].m(a.parentNode,a))}for(Vn(),b=u.length;b<g.length;b+=1)y(b);qn()}},i(p){if(!c){for(let m=0;m<u.length;m+=1)R(g[m]);c=!0}},o(p){g=g.filter(Boolean);for(let m=0;m<g.length;m+=1)q(g[m]);c=!1},d(p){p&&(S(e),S(r),S(s),S(l),S(a)),Un(g,p),h=!1,K(f)}}}function io(t){let e,n;return e=new Re({props:{shape:t[0],transform:t[2],editor:t[5],$$slots:{default:[ro,({grab:o})=>({9:o}),({grab:o})=>o?512:0]},$$scope:{ctx:t}}}),e.$on("change",t[6]),e.$on("grab",t[7]),e.$on("release",t[8]),{c(){ht(e.$$.fragment)},m(o,r){tt(e,o,r),n=!0},p(o,[r]){const s={};r&1&&(s.shape=o[0]),r&4&&(s.transform=o[2]),r&8730&&(s.$$scope={dirty:r,ctx:o}),e.$set(s)},i(o){n||(R(e.$$.fragment,o),n=!0)},o(o){q(e.$$.fragment,o),n=!1},d(o){et(e,o)}}}const ze=t=>t.join(","),Xe=t=>t.join(",");function so(t,e,n){let o,{shape:r}=e,{computedStyle:s}=e,{transform:i}=e,{viewportScale:l=1}=e;const a=(u,g,y)=>{let p;const m=u.geometry;g==="SHAPE"?p=m.points.map(([x,w])=>[x+y[0],w+y[1]]):p=m.points.map(([x,w],O)=>g===`HANDLE-${O}`?[x+y[0],w+y[1]]:[x,w]);const b=Jn(p);return{...u,geometry:{points:p,bounds:b}}};function c(u){Q.call(this,t,u)}function h(u){Q.call(this,t,u)}function f(u){Q.call(this,t,u)}return t.$$set=u=>{"shape"in u&&n(0,r=u.shape),"computedStyle"in u&&n(1,s=u.computedStyle),"transform"in u&&n(2,i=u.transform),"viewportScale"in u&&n(3,l=u.viewportScale)},t.$$.update=()=>{t.$$.dirty&1&&n(4,o=r.geometry)},[r,s,i,l,o,a,c,h,f]}class ao extends Ct{constructor(e){super(),Xt(this,e,so,io,Gt,{shape:0,computedStyle:1,transform:2,viewportScale:3})}}const lo="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;function co(t){let e,n,o,r,s,i;return{c(){e=U("rect"),d(e,"class",n=Ut(`a9s-handle ${t[8].class||""}`.trim())+" svelte-1sgkh33"),d(e,"x",o=t[0]-t[5]/2),d(e,"y",r=t[1]-t[5]/2),d(e,"width",t[5]),d(e,"height",t[5])},m(l,a){T(l,e,a),s||(i=I(e,"pointerdown",t[11]),s=!0)},p(l,a){a&256&&n!==(n=Ut(`a9s-handle ${l[8].class||""}`.trim())+" svelte-1sgkh33")&&d(e,"class",n),a&33&&o!==(o=l[0]-l[5]/2)&&d(e,"x",o),a&34&&r!==(r=l[1]-l[5]/2)&&d(e,"y",r),a&32&&d(e,"width",l[5]),a&32&&d(e,"height",l[5])},d(l){l&&S(e),s=!1,i()}}}function fo(t){let e,n,o,r,s,i,l,a,c;return{c(){e=U("g"),n=U("circle"),r=U("rect"),d(n,"cx",t[0]),d(n,"cy",t[1]),d(n,"r",o=t[3]/t[2]),d(n,"class","a9s-touch-halo svelte-1sgkh33"),ke(n,"touched",t[4]),d(r,"class",s=Ut(`a9s-handle ${t[8].class||""}`.trim())+" svelte-1sgkh33"),d(r,"x",i=t[0]-t[5]/2),d(r,"y",l=t[1]-t[5]/2),d(r,"width",t[5]),d(r,"height",t[5]),d(e,"class","a9s-touch-handle")},m(h,f){T(h,e,f),Ae(e,n),Ae(e,r),a||(c=[I(n,"pointerdown",t[10]),I(n,"pointerdown",t[6]),I(n,"pointerup",t[7]),I(r,"pointerdown",t[9]),I(r,"pointerdown",t[6]),I(r,"pointerup",t[7])],a=!0)},p(h,f){f&1&&d(n,"cx",h[0]),f&2&&d(n,"cy",h[1]),f&12&&o!==(o=h[3]/h[2])&&d(n,"r",o),f&16&&ke(n,"touched",h[4]),f&256&&s!==(s=Ut(`a9s-handle ${h[8].class||""}`.trim())+" svelte-1sgkh33")&&d(r,"class",s),f&33&&i!==(i=h[0]-h[5]/2)&&d(r,"x",i),f&34&&l!==(l=h[1]-h[5]/2)&&d(r,"y",l),f&32&&d(r,"width",h[5]),f&32&&d(r,"height",h[5])},d(h){h&&S(e),a=!1,K(c)}}}function uo(t){let e;function n(r,s){return lo?fo:co}let o=n()(t);return{c(){o.c(),e=Me()},m(r,s){o.m(r,s),T(r,e,s)},p(r,[s]){o.p(r,s)},i:Lt,o:Lt,d(r){r&&S(e),o.d(r)}}}function ho(t,e,n){let o,{x:r}=e,{y:s}=e,{scale:i}=e,{radius:l=30}=e,a=!1;const c=y=>{y.pointerType==="touch"&&n(4,a=!0)},h=()=>n(4,a=!1);function f(y){Q.call(this,t,y)}function u(y){Q.call(this,t,y)}function g(y){Q.call(this,t,y)}return t.$$set=y=>{n(8,e=oe(oe({},e),Pe(y))),"x"in y&&n(0,r=y.x),"y"in y&&n(1,s=y.y),"scale"in y&&n(2,i=y.scale),"radius"in y&&n(3,l=y.radius)},t.$$.update=()=>{t.$$.dirty&4&&n(5,o=10/i)},e=Pe(e),[r,s,i,l,a,o,c,h,e,f,u,g]}class At extends Ct{constructor(e){super(),Xt(this,e,ho,uo,Gt,{x:0,y:1,scale:2,radius:3})}}function po(t){let e,n,o,r,s,i,l,a,c,h,f,u,g,y,p,m,b,x,w,O,M,v,N,L,j,nt,Rt,le,F,Ft,Bt,Wt,ce,ot,fe,rt,ue,it,de,st,E,he,Je;return ot=new At({props:{class:"a9s-corner-handle-topleft",x:t[4].x,y:t[4].y,scale:t[3]}}),ot.$on("pointerdown",function(){k(t[9]("TOP_LEFT"))&&t[9]("TOP_LEFT").apply(this,arguments)}),rt=new At({props:{class:"a9s-corner-handle-topright",x:t[4].x+t[4].w,y:t[4].y,scale:t[3]}}),rt.$on("pointerdown",function(){k(t[9]("TOP_RIGHT"))&&t[9]("TOP_RIGHT").apply(this,arguments)}),it=new At({props:{class:"a9s-corner-handle-bottomright",x:t[4].x+t[4].w,y:t[4].y+t[4].h,scale:t[3]}}),it.$on("pointerdown",function(){k(t[9]("BOTTOM_RIGHT"))&&t[9]("BOTTOM_RIGHT").apply(this,arguments)}),st=new At({props:{class:"a9s-corner-handle-bottomleft",x:t[4].x,y:t[4].y+t[4].h,scale:t[3]}}),st.$on("pointerdown",function(){k(t[9]("BOTTOM_LEFT"))&&t[9]("BOTTOM_LEFT").apply(this,arguments)}),{c(){e=U("rect"),l=W(),a=U("rect"),g=W(),y=U("rect"),x=W(),w=U("rect"),N=W(),L=U("rect"),le=W(),F=U("rect"),ce=W(),ht(ot.$$.fragment),fe=W(),ht(rt.$$.fragment),ue=W(),ht(it.$$.fragment),de=W(),ht(st.$$.fragment),d(e,"class","a9s-outer"),d(e,"style",n=t[1]?"display:none;":void 0),d(e,"x",o=t[4].x),d(e,"y",r=t[4].y),d(e,"width",s=t[4].w),d(e,"height",i=t[4].h),d(a,"class","a9s-inner a9s-shape-handle"),d(a,"style",t[1]),d(a,"x",c=t[4].x),d(a,"y",h=t[4].y),d(a,"width",f=t[4].w),d(a,"height",u=t[4].h),d(y,"class","a9s-edge-handle a9s-edge-handle-top"),d(y,"x",p=t[4].x),d(y,"y",m=t[4].y),d(y,"height",1),d(y,"width",b=t[4].w),d(w,"class","a9s-edge-handle a9s-edge-handle-right"),d(w,"x",O=t[4].x+t[4].w),d(w,"y",M=t[4].y),d(w,"height",v=t[4].h),d(w,"width",1),d(L,"class","a9s-edge-handle a9s-edge-handle-bottom"),d(L,"x",j=t[4].x),d(L,"y",nt=t[4].y+t[4].h),d(L,"height",1),d(L,"width",Rt=t[4].w),d(F,"class","a9s-edge-handle a9s-edge-handle-left"),d(F,"x",Ft=t[4].x),d(F,"y",Bt=t[4].y),d(F,"height",Wt=t[4].h),d(F,"width",1)},m($,_){T($,e,_),T($,l,_),T($,a,_),T($,g,_),T($,y,_),T($,x,_),T($,w,_),T($,N,_),T($,L,_),T($,le,_),T($,F,_),T($,ce,_),tt(ot,$,_),T($,fe,_),tt(rt,$,_),T($,ue,_),tt(it,$,_),T($,de,_),tt(st,$,_),E=!0,he||(Je=[I(e,"pointerdown",function(){k(t[9]("SHAPE"))&&t[9]("SHAPE").apply(this,arguments)}),I(a,"pointerdown",function(){k(t[9]("SHAPE"))&&t[9]("SHAPE").apply(this,arguments)}),I(y,"pointerdown",function(){k(t[9]("TOP"))&&t[9]("TOP").apply(this,arguments)}),I(w,"pointerdown",function(){k(t[9]("RIGHT"))&&t[9]("RIGHT").apply(this,arguments)}),I(L,"pointerdown",function(){k(t[9]("BOTTOM"))&&t[9]("BOTTOM").apply(this,arguments)}),I(F,"pointerdown",function(){k(t[9]("LEFT"))&&t[9]("LEFT").apply(this,arguments)})],he=!0)},p($,_){t=$,(!E||_&2&&n!==(n=t[1]?"display:none;":void 0))&&d(e,"style",n),(!E||_&16&&o!==(o=t[4].x))&&d(e,"x",o),(!E||_&16&&r!==(r=t[4].y))&&d(e,"y",r),(!E||_&16&&s!==(s=t[4].w))&&d(e,"width",s),(!E||_&16&&i!==(i=t[4].h))&&d(e,"height",i),(!E||_&2)&&d(a,"style",t[1]),(!E||_&16&&c!==(c=t[4].x))&&d(a,"x",c),(!E||_&16&&h!==(h=t[4].y))&&d(a,"y",h),(!E||_&16&&f!==(f=t[4].w))&&d(a,"width",f),(!E||_&16&&u!==(u=t[4].h))&&d(a,"height",u),(!E||_&16&&p!==(p=t[4].x))&&d(y,"x",p),(!E||_&16&&m!==(m=t[4].y))&&d(y,"y",m),(!E||_&16&&b!==(b=t[4].w))&&d(y,"width",b),(!E||_&16&&O!==(O=t[4].x+t[4].w))&&d(w,"x",O),(!E||_&16&&M!==(M=t[4].y))&&d(w,"y",M),(!E||_&16&&v!==(v=t[4].h))&&d(w,"height",v),(!E||_&16&&j!==(j=t[4].x))&&d(L,"x",j),(!E||_&16&&nt!==(nt=t[4].y+t[4].h))&&d(L,"y",nt),(!E||_&16&&Rt!==(Rt=t[4].w))&&d(L,"width",Rt),(!E||_&16&&Ft!==(Ft=t[4].x))&&d(F,"x",Ft),(!E||_&16&&Bt!==(Bt=t[4].y))&&d(F,"y",Bt),(!E||_&16&&Wt!==(Wt=t[4].h))&&d(F,"height",Wt);const jt={};_&16&&(jt.x=t[4].x),_&16&&(jt.y=t[4].y),_&8&&(jt.scale=t[3]),ot.$set(jt);const Vt={};_&16&&(Vt.x=t[4].x+t[4].w),_&16&&(Vt.y=t[4].y),_&8&&(Vt.scale=t[3]),rt.$set(Vt);const qt={};_&16&&(qt.x=t[4].x+t[4].w),_&16&&(qt.y=t[4].y+t[4].h),_&8&&(qt.scale=t[3]),it.$set(qt);const Dt={};_&16&&(Dt.x=t[4].x),_&16&&(Dt.y=t[4].y+t[4].h),_&8&&(Dt.scale=t[3]),st.$set(Dt)},i($){E||(R(ot.$$.fragment,$),R(rt.$$.fragment,$),R(it.$$.fragment,$),R(st.$$.fragment,$),E=!0)},o($){q(ot.$$.fragment,$),q(rt.$$.fragment,$),q(it.$$.fragment,$),q(st.$$.fragment,$),E=!1},d($){$&&(S(e),S(l),S(a),S(g),S(y),S(x),S(w),S(N),S(L),S(le),S(F),S(ce),S(fe),S(ue),S(de)),et(ot,$),et(rt,$),et(it,$),et(st,$),he=!1,K(Je)}}}function go(t){let e,n;return e=new Re({props:{shape:t[0],transform:t[2],editor:t[5],$$slots:{default:[po,({grab:o})=>({9:o}),({grab:o})=>o?512:0]},$$scope:{ctx:t}}}),e.$on("grab",t[6]),e.$on("change",t[7]),e.$on("release",t[8]),{c(){ht(e.$$.fragment)},m(o,r){tt(e,o,r),n=!0},p(o,[r]){const s={};r&1&&(s.shape=o[0]),r&4&&(s.transform=o[2]),r&1562&&(s.$$scope={dirty:r,ctx:o}),e.$set(s)},i(o){n||(R(e.$$.fragment,o),n=!0)},o(o){q(e.$$.fragment,o),n=!1},d(o){et(e,o)}}}function mo(t,e,n){let o,{shape:r}=e,{computedStyle:s}=e,{transform:i}=e,{viewportScale:l=1}=e;const a=(u,g,y)=>{const p=u.geometry.bounds;let[m,b]=[p.minX,p.minY],[x,w]=[p.maxX,p.maxY];const[O,M]=y;if(g==="SHAPE")m+=O,x+=O,b+=M,w+=M;else{switch(g){case"TOP":case"TOP_LEFT":case"TOP_RIGHT":{b+=M;break}case"BOTTOM":case"BOTTOM_LEFT":case"BOTTOM_RIGHT":{w+=M;break}}switch(g){case"LEFT":case"TOP_LEFT":case"BOTTOM_LEFT":{m+=O;break}case"RIGHT":case"TOP_RIGHT":case"BOTTOM_RIGHT":{x+=O;break}}}const v=Math.min(m,x),N=Math.min(b,w),L=Math.abs(x-m),j=Math.abs(w-b);return{...u,geometry:{x:v,y:N,w:L,h:j,bounds:{minX:v,minY:N,maxX:v+L,maxY:N+j}}}};function c(u){Q.call(this,t,u)}function h(u){Q.call(this,t,u)}function f(u){Q.call(this,t,u)}return t.$$set=u=>{"shape"in u&&n(0,r=u.shape),"computedStyle"in u&&n(1,s=u.computedStyle),"transform"in u&&n(2,i=u.transform),"viewportScale"in u&&n(3,l=u.viewportScale)},t.$$.update=()=>{t.$$.dirty&1&&n(4,o=r.geometry)},[r,s,i,l,o,a,c,h,f]}class yo extends Ct{constructor(e){super(),Xt(this,e,mo,go,Gt,{shape:0,computedStyle:1,transform:2,viewportScale:3})}}D.RECTANGLE,D.POLYGON;const _o=t=>({}),Ce=t=>({grab:t[0]});function bo(t){let e,n,o,r;const s=t[7].default,i=Nn(s,t,t[6],Ce);return{c(){e=U("g"),i&&i.c(),d(e,"class","a9s-annotation selected")},m(l,a){T(l,e,a),i&&i.m(e,null),n=!0,o||(r=[I(e,"pointerup",t[2]),I(e,"pointermove",t[1])],o=!0)},p(l,[a]){i&&i.p&&(!n||a&64)&&Hn(i,s,l,l[6],n?Yn(s,l[6],a,_o):Gn(l[6]),Ce)},i(l){n||(R(i,l),n=!0)},o(l){q(i,l),n=!1},d(l){l&&S(e),i&&i.d(l),o=!1,K(r)}}}function wo(t,e,n){let{$$slots:o={},$$scope:r}=e;const s=Rn();let{shape:i}=e,{editor:l}=e,{transform:a}=e,c,h,f;const u=p=>m=>{c=p,h=a.elementToImage(m.offsetX,m.offsetY),f=i,m.target.setPointerCapture(m.pointerId),s("grab",m)},g=p=>{if(c){const[m,b]=a.elementToImage(p.offsetX,p.offsetY),x=[m-h[0],b-h[1]];n(3,i=l(f,c,x)),s("change",i)}},y=p=>{p.target.releasePointerCapture(p.pointerId),c=void 0,f=i,s("release",p)};return t.$$set=p=>{"shape"in p&&n(3,i=p.shape),"editor"in p&&n(4,l=p.editor),"transform"in p&&n(5,a=p.transform),"$$scope"in p&&n(6,r=p.$$scope)},[u,g,y,i,l,a,r,o]}class Re extends Ct{constructor(e){super(),Xt(this,e,wo,bo,Gt,{shape:3,editor:4,transform:5})}}navigator.userAgent.indexOf("Mac OS X");const Fe=t=>new Promise(e=>{var n;if((n=t.world.getItemAt(0))!=null&&n.source){const{x:o,y:r}=t.world.getItemAt(0).source.dimensions;e({width:o,height:r})}else{const o=()=>{const{x:r,y:s}=t.world.getItemAt(0).source.dimensions;t.removeHandler("open",o),e({width:r,height:s})};t.addHandler("open",o)}}),$o=(t,e,n)=>{const{bounds:o}=t.geometry,r=o.minX*e,s=o.minY*n,i=o.maxX*e,l=o.maxY*n;return t.type===D.RECTANGLE?{type:D.RECTANGLE,geometry:{bounds:{minX:r,minY:s,maxX:i,maxY:l},x:r,y:s,w:i-r,h:l-s}}:t.type===D.POLYGON?{type:D.POLYGON,geometry:{bounds:{minX:r,minY:s,maxX:i,maxY:l},points:t.geometry.points.map(([a,c])=>[a*e,c*n])}}:(console.error("Unsupported shape type",t),t)},xo=(t,e,n)=>{const o=e.width,r=e.height,s=n.width,i=n.height;if(o&&r){const l=s/o,a=i/r;return l===1&&a===1?{scaled:t,scaleX:l,scaleY:a}:(console.log("[TextLayerExtension] Page and image are different size - scaling annotations"),{scaled:t.map(h=>({...h,target:{...h.target,selector:$o(h.target.selector,l,a)}})),scaleX:l,scaleY:a})}else return console.warn("[TextLayerExtension] Cannot scale annotations without page dimensions"),{scaled:t,scaleX:1,scaleY:1}};function Be(t,e,n){const o=t.slice();return o[13]=e[n],o}function We(t,e,n){const o=t.slice();return o[13]=e[n],o}function je(t,e,n){const o=t.slice();return o[13]=e[n],o}function Ve(t){let e,n,o,r,s;const i=[To,So,Eo],l=[];function a(c,h){return c[0].mode==="fixedScreenSize"||!c[0].mode?0:c[0].mode==="fixedPageSize"?1:c[0].mode==="fillBounds"?2:-1}return~(n=a(t))&&(o=l[n]=i[n](t)),{c(){e=lt("div"),o&&o.c(),X(e,"style",r=`transform:${t[3]}; width: ${t[6]}px; height: ${t[7]}px; font-size: ${t[8]}px;`),X(e,"class","a9s-annotationlayer a9s-osd-textlayer"),C(e,"fixed-screen-size",t[0].mode==="fixedScreenSize"||!t[0].mode),C(e,"fixed-page-size",t[0].mode==="fixedPageSize"),C(e,"fill-bounds",t[0].mode==="fillBounds"),C(e,"bottomleft",t[0].position!=="topleft"),C(e,"topleft",t[0].position==="topleft"),C(e,"pointer-events",t[2])},m(c,h){B(c,e,h),~n&&l[n].m(e,null),s=!0},p(c,h){let f=n;n=a(c),n===f?~n&&l[n].p(c,h):(o&&(St(),G(l[f],1,1,()=>{l[f]=null}),Tt()),~n?(o=l[n],o?o.p(c,h):(o=l[n]=i[n](c),o.c()),P(o,1),o.m(e,null)):o=null),(!s||h&456&&r!==(r=`transform:${c[3]}; width: ${c[6]}px; height: ${c[7]}px; font-size: ${c[8]}px;`))&&X(e,"style",r),(!s||h&1)&&C(e,"fixed-screen-size",c[0].mode==="fixedScreenSize"||!c[0].mode),(!s||h&1)&&C(e,"fixed-page-size",c[0].mode==="fixedPageSize"),(!s||h&1)&&C(e,"fill-bounds",c[0].mode==="fillBounds"),(!s||h&1)&&C(e,"bottomleft",c[0].position!=="topleft"),(!s||h&1)&&C(e,"topleft",c[0].position==="topleft"),(!s||h&4)&&C(e,"pointer-events",c[2])},i(c){s||(P(o),s=!0)},o(c){G(o),s=!1},d(c){c&&z(e),~n&&l[n].d()}}}function Eo(t){let e,n,o=yt(t[5]),r=[];for(let i=0;i<o.length;i+=1)r[i]=qe(Be(t,o,i));const s=i=>G(r[i],1,1,()=>{r[i]=null});return{c(){for(let i=0;i<r.length;i+=1)r[i].c();e=ft()},m(i,l){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(i,l);B(i,e,l),n=!0},p(i,l){if(l&33){o=yt(i[5]);let a;for(a=0;a<o.length;a+=1){const c=Be(i,o,a);r[a]?(r[a].p(c,l),P(r[a],1)):(r[a]=qe(c),r[a].c(),P(r[a],1),r[a].m(e.parentNode,e))}for(St(),a=o.length;a<r.length;a+=1)s(a);Tt()}},i(i){if(!n){for(let l=0;l<o.length;l+=1)P(r[l]);n=!0}},o(i){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)G(r[l]);n=!1},d(i){i&&z(e),Jt(r,i)}}}function So(t){let e,n,o=yt(t[5]),r=[];for(let i=0;i<o.length;i+=1)r[i]=De(We(t,o,i));const s=i=>G(r[i],1,1,()=>{r[i]=null});return{c(){for(let i=0;i<r.length;i+=1)r[i].c();e=ft()},m(i,l){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(i,l);B(i,e,l),n=!0},p(i,l){if(l&33){o=yt(i[5]);let a;for(a=0;a<o.length;a+=1){const c=We(i,o,a);r[a]?(r[a].p(c,l),P(r[a],1)):(r[a]=De(c),r[a].c(),P(r[a],1),r[a].m(e.parentNode,e))}for(St(),a=o.length;a<r.length;a+=1)s(a);Tt()}},i(i){if(!n){for(let l=0;l<o.length;l+=1)P(r[l]);n=!0}},o(i){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)G(r[l]);n=!1},d(i){i&&z(e),Jt(r,i)}}}function To(t){let e,n,o=yt(t[5]),r=[];for(let i=0;i<o.length;i+=1)r[i]=Ze(je(t,o,i));const s=i=>G(r[i],1,1,()=>{r[i]=null});return{c(){for(let i=0;i<r.length;i+=1)r[i].c();e=ft()},m(i,l){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(i,l);B(i,e,l),n=!0},p(i,l){if(l&241){o=yt(i[5]);let a;for(a=0;a<o.length;a+=1){const c=je(i,o,a);r[a]?(r[a].p(c,l),P(r[a],1)):(r[a]=Ze(c),r[a].c(),P(r[a],1),r[a].m(e.parentNode,e))}for(St(),a=o.length;a<r.length;a+=1)s(a);Tt()}},i(i){if(!n){for(let l=0;l<o.length;l+=1)P(r[l]);n=!0}},o(i){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)G(r[l]);n=!1},d(i){i&&z(e),Jt(r,i)}}}function qe(t){let e,n;return e=new Sn({props:{annotation:t[13],opts:t[0]}}),{c(){ne(e.$$.fragment)},m(o,r){vt(e,o,r),n=!0},p(o,r){const s={};r&32&&(s.annotation=o[13]),r&1&&(s.opts=o[0]),e.$set(s)},i(o){n||(P(e.$$.fragment,o),n=!0)},o(o){G(e.$$.fragment,o),n=!1},d(o){Nt(e,o)}}}function De(t){let e,n;return e=new On({props:{annotation:t[13],opts:t[0]}}),{c(){ne(e.$$.fragment)},m(o,r){vt(e,o,r),n=!0},p(o,r){const s={};r&32&&(s.annotation=o[13]),r&1&&(s.opts=o[0]),e.$set(s)},i(o){n||(P(e.$$.fragment,o),n=!0)},o(o){G(e.$$.fragment,o),n=!1},d(o){Nt(e,o)}}}function Ze(t){let e,n;return e=new In({props:{annotation:t[13],opts:t[0],imageSize:[t[6],t[7]],scale:t[4]}}),{c(){ne(e.$$.fragment)},m(o,r){vt(e,o,r),n=!0},p(o,r){const s={};r&32&&(s.annotation=o[13]),r&1&&(s.opts=o[0]),r&192&&(s.imageSize=[o[6],o[7]]),r&16&&(s.scale=o[4]),e.$set(s)},i(o){n||(P(e.$$.fragment,o),n=!0)},o(o){G(e.$$.fragment,o),n=!1},d(o){Nt(e,o)}}}function Lo(t){let e,n,o=t[1]&&Ve(t);return{c(){o&&o.c(),e=ft()},m(r,s){o&&o.m(r,s),B(r,e,s),n=!0},p(r,[s]){r[1]?o?(o.p(r,s),s&2&&P(o,1)):(o=Ve(r),o.c(),P(o,1),o.m(e.parentNode,e)):o&&(St(),G(o,1,1,()=>{o=null}),Tt())},i(r){n||(P(o),n=!0)},o(r){G(o),n=!1},d(r){r&&z(e),o&&o.d(r)}}}function Oo(t,e,n){let o,{state:r}=e,{viewer:s}=e,{opts:i}=e,{visible:l=!0}=e,{captureEvents:a=!1}=e;const{store:c}=r;let h,f,u=[],g,y;const p=()=>{const m=s.viewport.viewportToImageRectangle(s.viewport.getBounds(!0)),b=s.viewport.getContainerSize().x,x=s.viewport.getZoom(!0);n(4,f=x*b/s.world.getContentFactor());let w=Math.PI*s.viewport.getRotation(!0)/180;w<0&&(w+=2*Math.PI),w>2*Math.PI&&(w-=2*Math.PI);const O=s.viewport.getFlip(),M=O?s.viewport._containerInnerSize.x+m.x*f:-m.x*f,v=-m.y*f;let N,L;w>0&&w<=Math.PI/2?(N=m.height*f,L=0):w>Math.PI/2&&w<=Math.PI?(N=m.width*f,L=m.height*f):w>Math.PI&&w<=Math.PI*1.5?(N=0,L=m.width*f):(N=0,L=0);const j=Math.round(100*(N+M*Math.cos(w)-v*Math.sin(w)))/100,nt=Math.round(100*(L+M*Math.sin(w)+v*Math.cos(w)))/100;n(3,h=`translate(${j}px, ${nt}px) rotate(${w}rad) scaleX(${O?-f:f}) scaleY(${f})`)};return gn(()=>{Fe(s).then(x=>{n(6,g=x.width),n(7,y=x.height)}),s.addHandler("update-viewport",p);const m=x=>{n(5,u=x.state),p()};c.observe(m);const b=x=>{const w=document.getSelection().toString(),O=x.clipboardData||window.clipboardData;O.setData("text/plain",w),O.setData("text/html",w),x.preventDefault()};return document.addEventListener("copy",b),()=>{s.removeHandler("update-viewport",p),c.unobserve(m),document.removeEventListener("copy",b)}}),t.$$set=m=>{"state"in m&&n(9,r=m.state),"viewer"in m&&n(10,s=m.viewer),"opts"in m&&n(0,i=m.opts),"visible"in m&&n(1,l=m.visible),"captureEvents"in m&&n(2,a=m.captureEvents)},t.$$.update=()=>{t.$$.dirty&1&&n(8,o=i.fontSize||16)},[i,l,a,h,f,u,g,y,o,r,s]}class Po extends Ht{constructor(e){super(),Yt(this,e,Oo,Lo,It,{state:9,viewer:10,opts:0,visible:1,captureEvents:2})}}const Ao=(t,e)=>{const{viewer:n,state:o}=t;let r=e.defaultVisible===void 0?!0:e.defaultVisible,s=!1;const i=new Po({target:n.element.querySelector(".openseadragon-canvas"),props:{state:o,viewer:n,opts:e,visible:r}});return{isLocked:()=>s,isVisible:()=>r,loadOCR:(g,y="ALTO")=>fetch(g).then(p=>p.text()).then(p=>{const{annotations:m,metadata:b}=un(p);Fe(n).then(x=>{const{scaled:w,scaleY:O,scaleX:M}=xo(m,b,x);if(!e.fontSize&&b.avgLineWidth&&b.avgCharsPerLine){const v=.8*M*(b.avgLineWidth/b.avgCharsPerLine);i.$set({opts:{...e,fontSize:v}})}t.setAnnotations(w)})}),setLocked:g=>{s=g,n.setMouseNavEnabled(!g),i.$set({captureEvents:g})},setVisible:g=>{r=g,i.$set({visible:g})},unmount:()=>i.$destroy()}};Y.mountExtension=Ao,Y.transcriptionLabel=H,Object.defineProperty(Y,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=annotorious-openseadragon-textlayer.js.map
